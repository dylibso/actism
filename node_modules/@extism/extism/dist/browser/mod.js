var ze=Object.create;var St=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Je=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var Ue=(o,t,e)=>t in o?St(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var jt=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var Pe=(o,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Me(t))!Ae.call(o,i)&&i!==e&&St(o,i,{get:()=>t[i],enumerable:!(s=Be(t,i))||s.enumerable});return o};var ve=(o,t,e)=>(e=o!=null?ze(Je(o)):{},Pe(t||!o||!o.__esModule?St(e,"default",{value:o,enumerable:!0}):e,o));var $t=(o,t,e)=>(Ue(o,typeof t!="symbol"?t+"":t,e),e),Et=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var m=(o,t,e)=>(Et(o,t,"read from private field"),e?e.call(o):t.get(o)),V=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},x=(o,t,e,s)=>(Et(o,t,"write to private field"),s?s.call(o,e):t.set(o,e),e);var B=(o,t,e)=>(Et(o,t,"access private method"),e);var pe=jt((ui,fe)=>{"use strict";fe.exports=he;function he(o,t,e){o instanceof RegExp&&(o=ue(o,e)),t instanceof RegExp&&(t=ue(t,e));var s=me(o,t,e);return s&&{start:s[0],end:s[1],pre:e.slice(0,s[0]),body:e.slice(s[0]+o.length,s[1]),post:e.slice(s[1]+t.length)}}function ue(o,t){var e=t.match(o);return e?e[0]:null}he.range=me;function me(o,t,e){var s,i,n,r,l,a=e.indexOf(o),c=e.indexOf(t,a+1),d=a;if(a>=0&&c>0){if(o===t)return[a,c];for(s=[],n=e.length;d>=0&&!l;)d==a?(s.push(d),a=e.indexOf(o,d+1)):s.length==1?l=[s.pop(),c]:(i=s.pop(),i<n&&(n=i,r=c),c=e.indexOf(t,d+1)),d=a<c&&a>=0?a:c;s.length&&(l=[n,r])}return l}});var xe=jt((hi,ge)=>{var be=pe();ge.exports=ls;var Ze="\0SLASH"+Math.random()+"\0",ye="\0OPEN"+Math.random()+"\0",Mt="\0CLOSE"+Math.random()+"\0",Ge="\0COMMA"+Math.random()+"\0",Re="\0PERIOD"+Math.random()+"\0";function Bt(o){return parseInt(o,10)==o?parseInt(o,10):o.charCodeAt(0)}function rs(o){return o.split("\\\\").join(Ze).split("\\{").join(ye).split("\\}").join(Mt).split("\\,").join(Ge).split("\\.").join(Re)}function os(o){return o.split(Ze).join("\\").split(ye).join("{").split(Mt).join("}").split(Ge).join(",").split(Re).join(".")}function Xe(o){if(!o)return[""];var t=[],e=be("{","}",o);if(!e)return o.split(",");var s=e.pre,i=e.body,n=e.post,r=s.split(",");r[r.length-1]+="{"+i+"}";var l=Xe(n);return n.length&&(r[r.length-1]+=l.shift(),r.push.apply(r,l)),t.push.apply(t,r),t}function ls(o){return o?(o.substr(0,2)==="{}"&&(o="\\{\\}"+o.substr(2)),mt(rs(o),!0).map(os)):[]}function as(o){return"{"+o+"}"}function cs(o){return/^-?0\d/.test(o)}function ds(o,t){return o<=t}function us(o,t){return o>=t}function mt(o,t){var e=[],s=be("{","}",o);if(!s)return[o];var i=s.pre,n=s.post.length?mt(s.post,!1):[""];if(/\$$/.test(s.pre))for(var r=0;r<n.length;r++){var l=i+"{"+s.body+"}"+n[r];e.push(l)}else{var a=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),d=a||c,f=s.body.indexOf(",")>=0;if(!d&&!f)return s.post.match(/,.*\}/)?(o=s.pre+"{"+s.body+Mt+s.post,mt(o)):[o];var u;if(d)u=s.body.split(/\.\./);else if(u=Xe(s.body),u.length===1&&(u=mt(u[0],!1).map(as),u.length===1))return n.map(function(Ke){return s.pre+u[0]+Ke});var p;if(d){var b=Bt(u[0]),h=Bt(u[1]),y=Math.max(u[0].length,u[1].length),X=u.length==3?Math.abs(Bt(u[2])):1,L=ds,F=h<b;F&&(X*=-1,L=us);var O=u.some(cs);p=[];for(var z=b;L(z,h);z+=X){var E;if(c)E=String.fromCharCode(z),E==="\\"&&(E="");else if(E=String(z),O){var Dt=y-E.length;if(Dt>0){var Qt=new Array(Dt+1).join("0");z<0?E="-"+Qt+E.slice(1):E=Qt+E}}p.push(E)}}else{p=[];for(var j=0;j<u.length;j++)p.push.apply(p,mt(u[j],!1))}for(var j=0;j<p.length;j++)for(var r=0;r<n.length;r++){var l=i+p[j]+n[r];(!t||d||l)&&e.push(l)}}return e}});var M={allowSharedBufferCodec:!1,manifestSupportsPaths:!1,crossOriginChecksEnforced:!0,fsAccess:!1,hasWorkerCapability:typeof globalThis<"u"?globalThis.crossOriginIsolated&&typeof SharedArrayBuffer<"u":!0,supportsWasiPreview1:!0,extismStdoutEnvVarSet:!1};async function qt(o){throw new Error("readFile not supported in this environment")}async function _t(o,t){if(String(o.headers.get("Content-Type")).split(";")[0]==="application/octet-stream"){let i=new Headers(o.headers);i.set("Content-Type","application/wasm"),o=new Response(o.body,{status:o.status,statusText:o.statusText,headers:i})}let e=t?await o.clone().arrayBuffer():void 0;return{module:await WebAssembly.compileStreaming(o),data:e}}async function Ct(o,t){if(o instanceof ArrayBuffer)return{wasm:[{data:new Uint8Array(o)}]};if(o instanceof WebAssembly.Module)return{wasm:[{module:o}]};if(typeof o=="string"){if(o.search(/^\s*\{/g)===0)return JSON.parse(o);if(o.search(/^(https?|file):\/\//)!==0)return{wasm:[{path:o}]};o=new URL(o)}if(o instanceof Response||o?.constructor?.name==="Response"){let s=o,i=s.headers.get("content-type")||"application/octet-stream";switch(i.split(";")[0]){case"application/octet-stream":case"application/wasm":return{wasm:[{response:s}]};case"application/json":case"text/json":return Ct(JSON.parse(await s.text()),t);default:throw new TypeError(`While processing manifest URL "${s.url}"; expected content-type of "text/json", "application/json", "application/octet-stream", or "application/wasm"; got "${i}" after stripping off charset.`)}}if(o instanceof URL)return Ct(await t(o,{redirect:"follow"}),t);if(!("wasm"in o))throw new TypeError('Expected "wasm" key in manifest');if(!Array.isArray(o.wasm))throw new TypeError('Expected "manifest.wasm" to be array');let e=o.wasm.findIndex(s=>!("data"in s)&&!("url"in s)&&!("path"in s)&&!("module"in s)&&!("response"in s));if(e>-1)throw new TypeError(`Expected every item in "manifest.wasm" to include either a "data", "url", or "path" key; got bad item at index ${e}`);return{...o}}async function De(o,t=fetch){let e=await Ct(o,t);return e.config??={},e}async function te(o,t){let e=[],s=await De(o,t),i=await Promise.all(s.wasm.map(async(n,r)=>{let l,a;if(n.data){let c=n.data;a=c.buffer?c.buffer:c,l=await WebAssembly.compile(c)}else if(n.path){let c=n.path,d=await qt(c);a=d.buffer,l=await WebAssembly.compile(d)}else if(n.url){let c=await t(n.url,{headers:{accept:"application/wasm;q=0.9,application/octet-stream;q=0.8","user-agent":"extism"}}),d=await _t(c,Boolean(n.hash));a=d.data,l=d.module}else if(n.response){let c=await _t(n.response,Boolean(n.hash));a=c.data,l=c.module}else if(n.module)e[r]=n.name??String(r),l=n.module;else throw new Error(`Unrecognized wasm item at index ${r}. Keys include: "${Object.keys(n).sort().join(",")}"`);if(n.hash){if(!a)throw new Error("Item specified a hash but WebAssembly.Module source data is unavailable for hashing");let c=new Uint8Array(await crypto.subtle.digest("SHA-256",a)),d=new Uint8Array(32),f=!0;for(let p=0;p<32;++p)d[p]=parseInt(n.hash.slice(p<<1,(p<<1)+2),16),f=f&&d[p]===c[p];let u=()=>[...c].map(p=>p.toString(16).padStart(2,"0")).join("");if(!f)throw new Error(`Plugin error: hash mismatch. Expected: ${n.hash}. Actual: ${u()}`);n.name??=u()}return e[r]=n.name??String(r),l}));return[e,i]}var yt,lt,Tt=class extends DataView{constructor(e){super(e);V(this,lt,null)}json(){return JSON.parse(this.string())}arrayBuffer(){return this.buffer}text(){return this.string()}string(){return m(Tt,yt).decode(this.buffer)}bytes(){return m(this,lt)??x(this,lt,new Uint8Array(this.buffer)),m(this,lt)}setInt8(e,s){throw new Error("Cannot set values on output")}setInt16(e,s,i){throw new Error("Cannot set values on output")}setInt32(e,s,i){throw new Error("Cannot set values on output")}setUint8(e,s){throw new Error("Cannot set values on output")}setUint16(e,s,i){throw new Error("Cannot set values on output")}setUint32(e,s,i){throw new Error("Cannot set values on output")}setFloat32(e,s,i){throw new Error("Cannot set values on output")}setFloat64(e,s,i){throw new Error("Cannot set values on output")}setBigInt64(e,s,i){throw new Error("Cannot set values on output")}setBigUint64(e,s,i){throw new Error("Cannot set values on output")}},Y=Tt;yt=new WeakMap,lt=new WeakMap,V(Y,yt,new TextDecoder);var Ft=Symbol("begin"),Gt=Symbol("end"),kt=Symbol("env"),at=Symbol("get-block"),Rt=Symbol("import-state"),Xt=Symbol("export-state"),$=Symbol("store-value"),ct=Symbol("reset"),G=class{get byteLength(){return this.buffer.byteLength}constructor(t,e){this.buffer=t,this.view=new DataView(this.buffer),this.local=e}static indexToAddress(t){return BigInt(t)<<48n}static addressToIndex(t){return Number(BigInt(t)>>48n)}static maskAddress(t){return Number(BigInt(t)&(1n<<48n)-1n)}},Qe,nt=class{constructor(t,e,s){this.#t=[];this.#o=new Map;this[Qe]={alloc:t=>this.alloc(t),free:t=>{this.#t[G.addressToIndex(t)]=null},load_u8:t=>{let e=G.addressToIndex(t),s=G.maskAddress(t);return this.#t[e]?.view.getUint8(Number(s))},load_u64:t=>{let e=G.addressToIndex(t),s=G.maskAddress(t);return this.#t[e]?.view.getBigUint64(Number(s),!0)},store_u8:(t,e)=>{let s=G.addressToIndex(t),i=G.maskAddress(t);this.#t[s]?.view.setUint8(Number(i),Number(e))},store_u64:(t,e)=>{let s=G.addressToIndex(t),i=G.maskAddress(t);this.#t[s]?.view.setBigUint64(Number(i),e,!0)},input_offset:()=>{let t=this.#e[this.#e.length-1][0];return G.indexToAddress(t||0)},input_length:()=>BigInt(this.#a?.byteLength??0),input_load_u8:t=>{let e=G.maskAddress(t);return this.#a?.view.getUint8(Number(e))},input_load_u64:t=>{let e=G.maskAddress(t);return this.#a?.view.getBigUint64(Number(e),!0)},output_set:(t,e)=>{let s=G.addressToIndex(t),i=this.#t[s];if(!i)throw new Error(`cannot assign to this block (addr=${t.toString(16).padStart(16,"0")}; length=${e})`);if(e>i.buffer.byteLength)throw new Error("length longer than target block");this.#e[this.#e.length-1][1]=s},error_set:t=>{let e=G.addressToIndex(t);if(!this.#t[e])throw new Error("cannot assign to this block");this.#e[this.#e.length-1][2]=e},config_get:t=>{let e=this.read(t);if(e===null)return 0n;let s=e.string();return s in this.#l?this.store(this.#l[s]):0n},var_get:t=>{let e=this.read(t);if(e===null)return 0n;let s=e.string();return this.#o.has(s)?G.indexToAddress(this.#o.get(s)):0n},var_set:(t,e)=>{let s=this.read(t);if(s===null)return 0n;let i=s.string();if(e===0n)return this.#o.delete(i),0n;this.#o.set(i,G.addressToIndex(e))},http_request:(t,e)=>(this.#s.error("http_request is not enabled"),0n),http_status_code:()=>(this.#s.error("http_status_code is not enabled"),0),length:t=>this.length(t),length_unsafe:t=>this.length(t),log_warn:t=>{let e=G.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(warn): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.warn(i)},log_info:t=>{let e=G.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(info): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.info(i)},log_debug:t=>{let e=G.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(debug): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.debug(i)},log_error:t=>{let e=G.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(error): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let i=this.#n.decode(s.buffer);this.#s.error(i)}};this.#i=t,this.#s=e,this.#n=new TextDecoder,this.#r=new TextEncoder,this.#e=[],this.alloc(1),this.#l=s}#e;#t;#s;#n;#r;#i;#l;#o;alloc(t){let e=new G(new this.#i(Number(t)),!0),s=this.#t.length;return this.#t.push(e),G.indexToAddress(s)}getVariable(t){return this.#o.has(t)?this.read(this.#o.get(t)):null}setVariable(t,e){let s=this[$](e);if(s===null)return 0n;let i=this.#o.get(t)??null;return i!==null&&(this.#t[i]=this.#t[s],this.#t[s]=null,s===this.#t.length-1&&this.#t.pop()),this.#o.set(t,i??s),G.indexToAddress(i??s)}read(t){let e=G.addressToIndex(t),s=this.#t[e];if(!s)return null;let i=!(s.buffer instanceof ArrayBuffer)&&!M.allowSharedBufferCodec?new Uint8Array(s.buffer).slice().buffer:s.buffer;return new Y(i)}store(t){let e=this[$](t);if(!e)throw new Error("failed to store output");return G.indexToAddress(e)}length(t){let e=G.addressToIndex(t),s=this.#t[e];return s?BigInt(s.buffer.byteLength):0n}get#a(){let t=this.#e[this.#e.length-1][0];return t===null?null:this.#t[t]}[(Qe=kt,ct)](){this.#t.length=1,this.#e.length=0}[at](t){let e=this.#t[t];if(!e)throw new Error(`invalid block index: ${t}`);return e}[Rt](t,e=!1){for(let[s,i]of t.blocks){if(s&&e){let n=new Uint8Array(new this.#i(Number(s.byteLength)));n.set(new Uint8Array(s)),s=n.buffer}this.#t[i]=s?new G(s,!1):null}this.#e=t.stack}[Xt](){return{stack:this.#e.slice(),blocks:this.#t.map((t,e)=>t?t.local?(t.local=!1,[t.buffer,e]):null:[null,e]).filter(Boolean)}}[$](t){if(!t)return null;if(typeof t=="string"&&(t=this.#r.encode(t)),t instanceof Uint8Array){if(t.buffer.constructor===this.#i){let n=this.#t.length;return this.#t.push(new G(t.buffer,!0)),n}let e=G.addressToIndex(this.alloc(t.length)),s=this.#t[e];return new Uint8Array(s.buffer).set(t,0),e}return t}[Ft](t){this.#e.push([t,null,null])}[Gt](){let[,t,e]=this.#e.pop(),s=e===null?1:0,i=e??t,n=[null,null];return i===null||this.#t[i]===null||(n[s]=i),n}};var J=class{static read_bytes(t,e){let s=new J;return s.buf=t.getUint32(e,!0),s.buf_len=t.getUint32(e+4,!0),s}static read_bytes_array(t,e,s){let i=[];for(let n=0;n<s;n++)i.push(J.read_bytes(t,e+8*n));return i}},A=class{static read_bytes(t,e){let s=new A;return s.buf=t.getUint32(e,!0),s.buf_len=t.getUint32(e+4,!0),s}static read_bytes_array(t,e,s){let i=[];for(let n=0;n<s;n++)i.push(A.read_bytes(t,e+8*n));return i}},ee=0,se=1,Ot=2;var Yt=4;var ne=1<<0,dn=1<<1,un=1<<2,hn=1<<3,mn=1<<4,gt=class{write_bytes(t,e){t.setUint8(e,this.fs_filetype),t.setUint16(e+2,this.fs_flags,!0),t.setBigUint64(e+8,this.fs_rights_base,!0),t.setBigUint64(e+16,this.fs_rights_inherited,!0)}constructor(t,e){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=t,this.fs_flags=e}},fn=1<<0,pn=1<<1,bn=1<<2,Zn=1<<3,je=1<<0,$e=1<<1,qe=1<<2,ts=1<<3,xt=class{write_bytes(t,e){t.setBigUint64(e,this.dev,!0),t.setBigUint64(e+8,this.ino,!0),t.setUint8(e+16,this.filetype),t.setBigUint64(e+24,this.nlink,!0),t.setBigUint64(e+32,this.size,!0),t.setBigUint64(e+38,this.atim,!0),t.setBigUint64(e+46,this.mtim,!0),t.setBigUint64(e+52,this.ctim,!0)}constructor(t,e){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=t,this.size=e}};var yn=1<<0,Gn=1<<0;var Rn=1<<0,Xn=1<<1,gn=1<<0,xn=1<<0,Wn=1<<1;var es=class{enable(t){this.log=ss(t===void 0?!0:t,this.prefix)}get enabled(){return this.isEnabled}constructor(t){this.isEnabled=t,this.prefix="wasi:",this.enable(t)}};function ss(o,t){return o?console.log.bind(console,"%c%s","color: #265BA0",t):()=>{}}var k=new es(!1);var Vt=class extends Error{constructor(t){super("exit with exit code "+t),this.code=t}},Kt=class{start(t){this.inst=t;try{t.exports._start()}catch(e){if(e instanceof Vt)return e.code;throw e}}initialize(t){this.inst=t,t.exports._initialize()}constructor(t,e,s,i={}){this.args=[],this.env=[],this.fds=[],k.enable(i.debug),this.args=t,this.env=e,this.fds=s;let n=this;this.wasiImport={args_sizes_get(r,l){let a=new DataView(n.inst.exports.memory.buffer);a.setUint32(r,n.args.length,!0);let c=0;for(let d of n.args)c+=d.length+1;return a.setUint32(l,c,!0),k.log(a.getUint32(r,!0),a.getUint32(l,!0)),0},args_get(r,l){let a=new DataView(n.inst.exports.memory.buffer),c=new Uint8Array(n.inst.exports.memory.buffer),d=l;for(let f=0;f<n.args.length;f++){a.setUint32(r,l,!0),r+=4;let u=new TextEncoder().encode(n.args[f]);c.set(u,l),a.setUint8(l+u.length,0),l+=u.length+1}return k.enabled&&k.log(new TextDecoder("utf-8").decode(c.slice(d,l))),0},environ_sizes_get(r,l){let a=new DataView(n.inst.exports.memory.buffer);a.setUint32(r,n.env.length,!0);let c=0;for(let d of n.env)c+=d.length+1;return a.setUint32(l,c,!0),k.log(a.getUint32(r,!0),a.getUint32(l,!0)),0},environ_get(r,l){let a=new DataView(n.inst.exports.memory.buffer),c=new Uint8Array(n.inst.exports.memory.buffer),d=l;for(let f=0;f<n.env.length;f++){a.setUint32(r,l,!0),r+=4;let u=new TextEncoder().encode(n.env[f]);c.set(u,l),a.setUint8(l+u.length,0),l+=u.length+1}return k.enabled&&k.log(new TextDecoder("utf-8").decode(c.slice(d,l))),0},clock_res_get(r,l){let a;switch(r){case 1:{a=5000n;break}case 0:{a=1000000n;break}default:return 52}return new DataView(n.inst.exports.memory.buffer).setBigUint64(l,a,!0),0},clock_time_get(r,l,a){let c=new DataView(n.inst.exports.memory.buffer);if(r===0)c.setBigUint64(a,BigInt(new Date().getTime())*1000000n,!0);else if(r==1){let d;try{d=BigInt(Math.round(performance.now()*1e6))}catch{d=0n}c.setBigUint64(a,d,!0)}else c.setBigUint64(a,0n,!0);return 0},fd_advise(r,l,a,c){return n.fds[r]!=null?n.fds[r].fd_advise(l,a,c):8},fd_allocate(r,l,a){return n.fds[r]!=null?n.fds[r].fd_allocate(l,a):8},fd_close(r){if(n.fds[r]!=null){let l=n.fds[r].fd_close();return n.fds[r]=void 0,l}else return 8},fd_datasync(r){return n.fds[r]!=null?n.fds[r].fd_datasync():8},fd_fdstat_get(r,l){if(n.fds[r]!=null){let{ret:a,fdstat:c}=n.fds[r].fd_fdstat_get();return c?.write_bytes(new DataView(n.inst.exports.memory.buffer),l),a}else return 8},fd_fdstat_set_flags(r,l){return n.fds[r]!=null?n.fds[r].fd_fdstat_set_flags(l):8},fd_fdstat_set_rights(r,l,a){return n.fds[r]!=null?n.fds[r].fd_fdstat_set_rights(l,a):8},fd_filestat_get(r,l){if(n.fds[r]!=null){let{ret:a,filestat:c}=n.fds[r].fd_filestat_get();return c?.write_bytes(new DataView(n.inst.exports.memory.buffer),l),a}else return 8},fd_filestat_set_size(r,l){return n.fds[r]!=null?n.fds[r].fd_filestat_set_size(l):8},fd_filestat_set_times(r,l,a,c){return n.fds[r]!=null?n.fds[r].fd_filestat_set_times(l,a,c):8},fd_pread(r,l,a,c,d){let f=new DataView(n.inst.exports.memory.buffer),u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let p=J.read_bytes_array(f,l,a),{ret:b,nread:h}=n.fds[r].fd_pread(u,p,c);return f.setUint32(d,h,!0),b}else return 8},fd_prestat_get(r,l){let a=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:c,prestat:d}=n.fds[r].fd_prestat_get();return d?.write_bytes(a,l),c}else return 8},fd_prestat_dir_name(r,l,a){if(n.fds[r]!=null){let{ret:c,prestat_dir_name:d}=n.fds[r].fd_prestat_dir_name();return d!=null&&new Uint8Array(n.inst.exports.memory.buffer).set(d,l),c}else return 8},fd_pwrite(r,l,a,c,d){let f=new DataView(n.inst.exports.memory.buffer),u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let p=A.read_bytes_array(f,l,a),{ret:b,nwritten:h}=n.fds[r].fd_pwrite(u,p,c);return f.setUint32(d,h,!0),b}else return 8},fd_read(r,l,a,c){let d=new DataView(n.inst.exports.memory.buffer),f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let u=J.read_bytes_array(d,l,a),{ret:p,nread:b}=n.fds[r].fd_read(f,u);return d.setUint32(c,b,!0),p}else return 8},fd_readdir(r,l,a,c,d){let f=new DataView(n.inst.exports.memory.buffer),u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let p=0;for(;;){let{ret:b,dirent:h}=n.fds[r].fd_readdir_single(c);if(b!=0)return f.setUint32(d,p,!0),b;if(h==null)break;if(a-p<h.head_length()){p=a;break}let y=new ArrayBuffer(h.head_length());if(h.write_head_bytes(new DataView(y),0),u.set(new Uint8Array(y).slice(0,Math.min(y.byteLength,a-p)),l),l+=h.head_length(),p+=h.head_length(),a-p<h.name_length()){p=a;break}h.write_name_bytes(u,l,a-p),l+=h.name_length(),p+=h.name_length(),c=h.d_next}return f.setUint32(d,p,!0),0}else return 8},fd_renumber(r,l){if(n.fds[r]!=null&&n.fds[l]!=null){let a=n.fds[l].fd_close();return a!=0?a:(n.fds[l]=n.fds[r],n.fds[r]=void 0,0)}else return 8},fd_seek(r,l,a,c){let d=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:f,offset:u}=n.fds[r].fd_seek(l,a);return d.setBigInt64(c,u,!0),f}else return 8},fd_sync(r){return n.fds[r]!=null?n.fds[r].fd_sync():8},fd_tell(r,l){let a=new DataView(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let{ret:c,offset:d}=n.fds[r].fd_tell();return a.setBigUint64(l,d,!0),c}else return 8},fd_write(r,l,a,c){let d=new DataView(n.inst.exports.memory.buffer),f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let u=A.read_bytes_array(d,l,a),{ret:p,nwritten:b}=n.fds[r].fd_write(f,u);return d.setUint32(c,b,!0),p}else return 8},path_create_directory(r,l,a){let c=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=new TextDecoder("utf-8").decode(c.slice(l,l+a));return n.fds[r].path_create_directory(d)}},path_filestat_get(r,l,a,c,d){let f=new DataView(n.inst.exports.memory.buffer),u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let p=new TextDecoder("utf-8").decode(u.slice(a,a+c)),{ret:b,filestat:h}=n.fds[r].path_filestat_get(l,p);return h?.write_bytes(f,d),b}else return 8},path_filestat_set_times(r,l,a,c,d,f,u){let p=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let b=new TextDecoder("utf-8").decode(p.slice(a,a+c));return n.fds[r].path_filestat_set_times(l,b,d,f,u)}else return 8},path_link(r,l,a,c,d,f,u){let p=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null&&n.fds[d]!=null){let b=new TextDecoder("utf-8").decode(p.slice(a,a+c)),h=new TextDecoder("utf-8").decode(p.slice(f,f+u));return n.fds[d].path_link(r,l,b,h)}else return 8},path_open(r,l,a,c,d,f,u,p,b){let h=new DataView(n.inst.exports.memory.buffer),y=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let X=new TextDecoder("utf-8").decode(y.slice(a,a+c));k.log(X);let{ret:L,fd_obj:F}=n.fds[r].path_open(l,X,d,f,u,p);if(L!=0)return L;n.fds.push(F);let O=n.fds.length-1;return h.setUint32(b,O,!0),0}else return 8},path_readlink(r,l,a,c,d,f){let u=new DataView(n.inst.exports.memory.buffer),p=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let b=new TextDecoder("utf-8").decode(p.slice(l,l+a));k.log(b);let{ret:h,data:y}=n.fds[r].path_readlink(b);if(y!=null){if(y.length>d)return u.setUint32(f,0,!0),8;p.set(y,c),u.setUint32(f,y.length,!0)}return h}else return 8},path_remove_directory(r,l,a){let c=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=new TextDecoder("utf-8").decode(c.slice(l,l+a));return n.fds[r].path_remove_directory(d)}else return 8},path_rename(r,l,a,c,d,f){throw"FIXME what is the best abstraction for this?"},path_symlink(r,l,a,c,d){let f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[a]!=null){let u=new TextDecoder("utf-8").decode(f.slice(r,r+l)),p=new TextDecoder("utf-8").decode(f.slice(c,c+d));return n.fds[a].path_symlink(u,p)}else return 8},path_unlink_file(r,l,a){let c=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[r]!=null){let d=new TextDecoder("utf-8").decode(c.slice(l,l+a));return n.fds[r].path_unlink_file(d)}else return 8},poll_oneoff(r,l,a){throw"async io not supported"},proc_exit(r){throw new Vt(r)},proc_raise(r){throw"raised signal "+r},sched_yield(){},random_get(r,l){let a=new Uint8Array(n.inst.exports.memory.buffer);for(let c=0;c<l;c++)a[r+c]=Math.random()*256|0},sock_recv(r,l,a){throw"sockets not supported"},sock_send(r,l,a){throw"sockets not supported"},sock_shutdown(r,l){throw"sockets not supported"},sock_accept(r,l){throw"sockets not supported"}}}};var q=class{fd_advise(t,e,s){return 58}fd_allocate(t,e){return 58}fd_close(){return 0}fd_datasync(){return 58}fd_fdstat_get(){return{ret:58,fdstat:null}}fd_fdstat_set_flags(t){return 58}fd_fdstat_set_rights(t,e){return 58}fd_filestat_get(){return{ret:58,filestat:null}}fd_filestat_set_size(t){return 58}fd_filestat_set_times(t,e,s){return 58}fd_pread(t,e,s){return{ret:58,nread:0}}fd_prestat_get(){return{ret:58,prestat:null}}fd_prestat_dir_name(){return{ret:58,prestat_dir_name:null}}fd_pwrite(t,e,s){return{ret:58,nwritten:0}}fd_read(t,e){return{ret:58,nread:0}}fd_readdir_single(t){return{ret:58,dirent:null}}fd_seek(t,e){return{ret:58,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:58,offset:0n}}fd_write(t,e){return{ret:58,nwritten:0}}path_create_directory(t){return 58}path_filestat_get(t,e){return{ret:58,filestat:null}}path_filestat_set_times(t,e,s,i,n){return 58}path_link(t,e,s,i){return 58}path_open(t,e,s,i,n,r){return{ret:58,fd_obj:null}}path_readlink(t){return{ret:58,data:null}}path_remove_directory(t){return 58}path_rename(t,e,s){return 58}path_symlink(t,e){return 58}path_unlink_file(t){return 58}};var U=class extends q{fd_fdstat_get(){return{ret:0,fdstat:new gt(Yt,0)}}fd_read(t,e){let s=0;for(let i of e)if(this.file_pos<this.file.data.byteLength){let n=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(i.buf_len)));t.set(n,i.buf),this.file_pos+=BigInt(n.length),s+=n.length}else break;return{ret:0,nread:s}}fd_pread(t,e,s){let i=0;for(let n of e)if(s<this.file.data.byteLength){let r=this.file.data.slice(Number(s),Number(s+BigInt(n.buf_len)));t.set(r,n.buf),s+=BigInt(r.length),i+=r.length}else break;return{ret:0,nread:i}}fd_seek(t,e){let s;switch(e){case ee:s=t;break;case se:s=this.file_pos+t;break;case Ot:s=BigInt(this.file.data.byteLength)+t;break;default:return{ret:28,offset:0n}}return s<0?{ret:28,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_tell(){return{ret:0,offset:this.file_pos}}fd_write(t,e){let s=0;if(this.file.readonly)return{ret:8,nwritten:s};for(let i of e){let n=t.slice(i.buf,i.buf+i.buf_len);if(this.file_pos+BigInt(n.byteLength)>this.file.size){let r=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(n.byteLength))),this.file.data.set(r)}this.file.data.set(n.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(n.byteLength),s+=i.buf_len}return{ret:0,nwritten:s}}fd_pwrite(t,e,s){let i=0;if(this.file.readonly)return{ret:8,nwritten:i};for(let n of e){let r=t.slice(n.buf,n.buf+n.buf_len);if(s+BigInt(r.byteLength)>this.file.size){let l=this.file.data;this.file.data=new Uint8Array(Number(s+BigInt(r.byteLength))),this.file.data.set(l)}this.file.data.set(r.slice(0,Number(this.file.size-s)),Number(s)),s+=BigInt(r.byteLength),i+=n.buf_len}return{ret:0,nwritten:i}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(t){super(),this.file_pos=0n,this.file=t}};var tt=class{open(t){let e=new U(this);return t&ne&&e.fd_seek(0n,Ot),e}get size(){return BigInt(this.data.byteLength)}stat(){return new xt(Yt,this.size)}truncate(){return this.readonly?63:(this.data=new Uint8Array([]),0)}constructor(t,e){this.data=new Uint8Array(t),this.readonly=!!e?.readonly}};var dt=class extends q{#e;constructor(t){super(),this.#e=t}fd_write(t,e){let s=0,i=new TextDecoder,n=e.reduce((r,l,a,c)=>{s+=l.buf_len;let d=t.slice(l.buf,l.buf+l.buf_len);return r+i.decode(d,{stream:a!==c.length-1})},"");return console[this.#e](n),{ret:0,nwritten:s}}};async function le(o,t){let e=[],s=[],i=t?[new dt("log"),new dt("log"),new dt("error")]:[new U(new tt([])),new U(new tt([])),new U(new tt([]))],n=new Kt(e,s,i);return{async importObject(){return n.wasiImport},async close(){},async initialize(r){let l=r.exports.memory;if(!l)throw new Error("The module has to export a default memory.");if(r.exports._initialize){let a=r.exports._initialize;n.initialize?n.initialize({exports:{memory:l,_initialize:()=>{a()}}}):a()}else n.start({exports:{memory:l,_start:()=>{}}})}}}var ut="extism:host/env",zt=class{#e;#t;#s;#n=!1;#r;constructor(t,e,s,i){this.#e=t,this.#s=e,this.#t=s,this.#r=i}async reset(){return this.isActive()?!1:(this.#e[ct](),!0)}isActive(){return this.#n}async functionExists(t){try{let e=[].concat(t),[s,i]=e.length===2?[this.lookupTarget(e[0]),e[1]]:[this.#t.find(r=>WebAssembly.Module.exports(r.module).find(a=>a.name===e[0]&&a.kind==="function")),e[0]];return!(!s||!s.instance.exports[i])}catch{return!1}}async callBlock(t,e){this.#n=!0;let s=[].concat(t),[i,n]=s.length===2?[this.lookupTarget(s[0]),s[1]]:[this.#t.find(l=>WebAssembly.Module.exports(l.module).find(c=>c.name===s[0]&&c.kind==="function")),s[0]];if(!i)throw Error(`Plugin error: target "${s.join('" "')}" does not exist`);let r=i.instance.exports[n];if(!r)throw Error(`Plugin error: function "${s.join('" "')}" does not exist`);this.#e[Ft](e??null);try{return r(),this.#e[Gt]()}catch(l){throw this.#e[Gt](),l}finally{this.#n=!1}}async call(t,e){let s=this.#e[$](e),[i,n]=await this.callBlock(t,s),r=i!==null,l=i??n;if(l===null)return null;let a=this.#e[at](l);if(!a)return null;let c=new Y(a.buffer);if(r)throw new Error(`Plugin-originated error: ${c.string()}`);return c}lookupTarget(t){let e=String(t??"0"),s=this.#s.findIndex(i=>i===e);if(s===-1)throw new Error(`no module named "${t}"`);return this.#t[s]}async getExports(t){return WebAssembly.Module.exports(this.lookupTarget(t).module)||[]}async getImports(t){return WebAssembly.Module.imports(this.lookupTarget(t).module)||[]}async getInstance(t){return this.lookupTarget(t).instance}async close(){this.#r&&(await this.#r.close(),this.#r=null)}};async function ae(o,t,e,s=new nt(ArrayBuffer,o.logger,o.config)){let i=o.wasiEnabled?await le(o.allowedPaths,o.enableWasiOutput):null,n={...i?{wasi_snapshot_preview1:await i.importObject()}:{},[ut]:s[kt],env:{}};for(let l in o.functions){n[l]=n[l]||{};for(let a in o.functions[l])n[l][a]=o.functions[l][a].bind(null,s)}let r=await Promise.all(e.map(async l=>{let a=await WebAssembly.instantiate(l,n);i&&await i?.initialize(a);let c=a.exports.hs_init?"haskell":a.exports._initialize?"reactor":a.exports._start?"command":"none";return(a.exports.hs_init?a.exports.hs_init:()=>{})(),{module:l,instance:a,guestType:c}}));return new zt(s,t,r,i)}var ce=new URL("data:text/javascript;base64,dmFyIHN0PShjLHQsZSk9PntpZighdC5oYXMoYykpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitlKX07dmFyIFU9KGMsdCxlKT0+KHN0KGMsdCwicmVhZCBmcm9tIHByaXZhdGUgZmllbGQiKSxlP2UuY2FsbChjKTp0LmdldChjKSksVj0oYyx0LGUpPT57aWYodC5oYXMoYykpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgYWRkIHRoZSBzYW1lIHByaXZhdGUgbWVtYmVyIG1vcmUgdGhhbiBvbmNlIik7dCBpbnN0YW5jZW9mIFdlYWtTZXQ/dC5hZGQoYyk6dC5zZXQoYyxlKX0scnQ9KGMsdCxlLHMpPT4oc3QoYyx0LCJ3cml0ZSB0byBwcml2YXRlIGZpZWxkIikscz9zLmNhbGwoYyxlKTp0LnNldChjLGUpLGUpO3ZhciBpdD17b24oYyx0KXthZGRFdmVudExpc3RlbmVyKGMsZT0+e3QoZS5kYXRhKX0pfSxwb3N0TWVzc2FnZShjLHQ9W10pe3NlbGYucG9zdE1lc3NhZ2UoYyx0KX19O3ZhciBGLEQsWT1jbGFzcyBleHRlbmRzIERhdGFWaWV3e2NvbnN0cnVjdG9yKGUpe3N1cGVyKGUpO1YodGhpcyxELG51bGwpfWpzb24oKXtyZXR1cm4gSlNPTi5wYXJzZSh0aGlzLnN0cmluZygpKX1hcnJheUJ1ZmZlcigpe3JldHVybiB0aGlzLmJ1ZmZlcn10ZXh0KCl7cmV0dXJuIHRoaXMuc3RyaW5nKCl9c3RyaW5nKCl7cmV0dXJuIFUoWSxGKS5kZWNvZGUodGhpcy5idWZmZXIpfWJ5dGVzKCl7cmV0dXJuIFUodGhpcyxEKT8/cnQodGhpcyxELG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyKSksVSh0aGlzLEQpfXNldEludDgoZSxzKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldEludDE2KGUscyxhKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldEludDMyKGUscyxhKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldFVpbnQ4KGUscyl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRVaW50MTYoZSxzLGEpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0VWludDMyKGUscyxhKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldEZsb2F0MzIoZSxzLGEpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0RmxvYXQ2NChlLHMsYSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRCaWdJbnQ2NChlLHMsYSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRCaWdVaW50NjQoZSxzLGEpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9fSx5PVk7Rj1uZXcgV2Vha01hcCxEPW5ldyBXZWFrTWFwLFYoeSxGLG5ldyBUZXh0RGVjb2Rlcik7dmFyIG90PXthbGxvd1NoYXJlZEJ1ZmZlckNvZGVjOiExLG1hbmlmZXN0U3VwcG9ydHNQYXRoczohMSxjcm9zc09yaWdpbkNoZWNrc0VuZm9yY2VkOiEwLGZzQWNjZXNzOiExLGhhc1dvcmtlckNhcGFiaWxpdHk6dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXMuY3Jvc3NPcmlnaW5Jc29sYXRlZCYmdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyPCJ1IjohMCxzdXBwb3J0c1dhc2lQcmV2aWV3MTohMCxleHRpc21TdGRvdXRFbnZWYXJTZXQ6ITF9O3ZhciB6PVN5bWJvbCgiYmVnaW4iKSxQPVN5bWJvbCgiZW5kIiksSz1TeW1ib2woImVudiIpLGo9U3ltYm9sKCJnZXQtYmxvY2siKSxrPVN5bWJvbCgiaW1wb3J0LXN0YXRlIiksQj1TeW1ib2woImV4cG9ydC1zdGF0ZSIpLEw9U3ltYm9sKCJzdG9yZS12YWx1ZSIpLFg9U3ltYm9sKCJyZXNldCIpLHA9Y2xhc3N7Z2V0IGJ5dGVMZW5ndGgoKXtyZXR1cm4gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aH1jb25zdHJ1Y3Rvcih0LGUpe3RoaXMuYnVmZmVyPXQsdGhpcy52aWV3PW5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciksdGhpcy5sb2NhbD1lfXN0YXRpYyBpbmRleFRvQWRkcmVzcyh0KXtyZXR1cm4gQmlnSW50KHQpPDw0OG59c3RhdGljIGFkZHJlc3NUb0luZGV4KHQpe3JldHVybiBOdW1iZXIoQmlnSW50KHQpPj40OG4pfXN0YXRpYyBtYXNrQWRkcmVzcyh0KXtyZXR1cm4gTnVtYmVyKEJpZ0ludCh0KSYoMW48PDQ4biktMW4pfX0sYnQsVD1jbGFzc3tjb25zdHJ1Y3Rvcih0LGUscyl7dGhpcy4jdD1bXTt0aGlzLiNyPW5ldyBNYXA7dGhpc1tidF09e2FsbG9jOnQ9PnRoaXMuYWxsb2ModCksZnJlZTp0PT57dGhpcy4jdFtwLmFkZHJlc3NUb0luZGV4KHQpXT1udWxsfSxsb2FkX3U4OnQ9PntsZXQgZT1wLmFkZHJlc3NUb0luZGV4KHQpLHM9cC5tYXNrQWRkcmVzcyh0KTtyZXR1cm4gdGhpcy4jdFtlXT8udmlldy5nZXRVaW50OChOdW1iZXIocykpfSxsb2FkX3U2NDp0PT57bGV0IGU9cC5hZGRyZXNzVG9JbmRleCh0KSxzPXAubWFza0FkZHJlc3ModCk7cmV0dXJuIHRoaXMuI3RbZV0/LnZpZXcuZ2V0QmlnVWludDY0KE51bWJlcihzKSwhMCl9LHN0b3JlX3U4Oih0LGUpPT57bGV0IHM9cC5hZGRyZXNzVG9JbmRleCh0KSxhPXAubWFza0FkZHJlc3ModCk7dGhpcy4jdFtzXT8udmlldy5zZXRVaW50OChOdW1iZXIoYSksTnVtYmVyKGUpKX0sc3RvcmVfdTY0Oih0LGUpPT57bGV0IHM9cC5hZGRyZXNzVG9JbmRleCh0KSxhPXAubWFza0FkZHJlc3ModCk7dGhpcy4jdFtzXT8udmlldy5zZXRCaWdVaW50NjQoTnVtYmVyKGEpLGUsITApfSxpbnB1dF9vZmZzZXQ6KCk9PntsZXQgdD10aGlzLiNlW3RoaXMuI2UubGVuZ3RoLTFdWzBdO3JldHVybiBwLmluZGV4VG9BZGRyZXNzKHR8fDApfSxpbnB1dF9sZW5ndGg6KCk9PkJpZ0ludCh0aGlzLiNsPy5ieXRlTGVuZ3RoPz8wKSxpbnB1dF9sb2FkX3U4OnQ9PntsZXQgZT1wLm1hc2tBZGRyZXNzKHQpO3JldHVybiB0aGlzLiNsPy52aWV3LmdldFVpbnQ4KE51bWJlcihlKSl9LGlucHV0X2xvYWRfdTY0OnQ9PntsZXQgZT1wLm1hc2tBZGRyZXNzKHQpO3JldHVybiB0aGlzLiNsPy52aWV3LmdldEJpZ1VpbnQ2NChOdW1iZXIoZSksITApfSxvdXRwdXRfc2V0Oih0LGUpPT57bGV0IHM9cC5hZGRyZXNzVG9JbmRleCh0KSxhPXRoaXMuI3Rbc107aWYoIWEpdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgYXNzaWduIHRvIHRoaXMgYmxvY2sgKGFkZHI9JHt0LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgxNiwiMCIpfTsgbGVuZ3RoPSR7ZX0pYCk7aWYoZT5hLmJ1ZmZlci5ieXRlTGVuZ3RoKXRocm93IG5ldyBFcnJvcigibGVuZ3RoIGxvbmdlciB0aGFuIHRhcmdldCBibG9jayIpO3RoaXMuI2VbdGhpcy4jZS5sZW5ndGgtMV1bMV09c30sZXJyb3Jfc2V0OnQ9PntsZXQgZT1wLmFkZHJlc3NUb0luZGV4KHQpO2lmKCF0aGlzLiN0W2VdKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGFzc2lnbiB0byB0aGlzIGJsb2NrIik7dGhpcy4jZVt0aGlzLiNlLmxlbmd0aC0xXVsyXT1lfSxjb25maWdfZ2V0OnQ9PntsZXQgZT10aGlzLnJlYWQodCk7aWYoZT09PW51bGwpcmV0dXJuIDBuO2xldCBzPWUuc3RyaW5nKCk7cmV0dXJuIHMgaW4gdGhpcy4jYT90aGlzLnN0b3JlKHRoaXMuI2Fbc10pOjBufSx2YXJfZ2V0OnQ9PntsZXQgZT10aGlzLnJlYWQodCk7aWYoZT09PW51bGwpcmV0dXJuIDBuO2xldCBzPWUuc3RyaW5nKCk7cmV0dXJuIHRoaXMuI3IuaGFzKHMpP3AuaW5kZXhUb0FkZHJlc3ModGhpcy4jci5nZXQocykpOjBufSx2YXJfc2V0Oih0LGUpPT57bGV0IHM9dGhpcy5yZWFkKHQpO2lmKHM9PT1udWxsKXJldHVybiAwbjtsZXQgYT1zLnN0cmluZygpO2lmKGU9PT0wbilyZXR1cm4gdGhpcy4jci5kZWxldGUoYSksMG47dGhpcy4jci5zZXQoYSxwLmFkZHJlc3NUb0luZGV4KGUpKX0saHR0cF9yZXF1ZXN0Oih0LGUpPT4odGhpcy4jbi5lcnJvcigiaHR0cF9yZXF1ZXN0IGlzIG5vdCBlbmFibGVkIiksMG4pLGh0dHBfc3RhdHVzX2NvZGU6KCk9Pih0aGlzLiNuLmVycm9yKCJodHRwX3N0YXR1c19jb2RlIGlzIG5vdCBlbmFibGVkIiksMCksbGVuZ3RoOnQ9PnRoaXMubGVuZ3RoKHQpLGxlbmd0aF91bnNhZmU6dD0+dGhpcy5sZW5ndGgodCksbG9nX3dhcm46dD0+e2xldCBlPXAuYWRkcmVzc1RvSW5kZXgodCkscz10aGlzLiN0W2VdO2lmKCFzKXJldHVybiB0aGlzLiNuLmVycm9yKGBmYWlsZWQgdG8gbG9nKHdhcm4pOiBiYWQgYmxvY2sgcmVmZXJlbmNlIGluIGFkZHIgMHgke3QudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDY0LCIwIil9YCk7bGV0IGE9dGhpcy4jcy5kZWNvZGUocy5idWZmZXIpO3RoaXMuI24ud2FybihhKX0sbG9nX2luZm86dD0+e2xldCBlPXAuYWRkcmVzc1RvSW5kZXgodCkscz10aGlzLiN0W2VdO2lmKCFzKXJldHVybiB0aGlzLiNuLmVycm9yKGBmYWlsZWQgdG8gbG9nKGluZm8pOiBiYWQgYmxvY2sgcmVmZXJlbmNlIGluIGFkZHIgMHgke3QudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDY0LCIwIil9YCk7bGV0IGE9dGhpcy4jcy5kZWNvZGUocy5idWZmZXIpO3RoaXMuI24uaW5mbyhhKX0sbG9nX2RlYnVnOnQ9PntsZXQgZT1wLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtlXTtpZighcylyZXR1cm4gdGhpcy4jbi5lcnJvcihgZmFpbGVkIHRvIGxvZyhkZWJ1Zyk6IGJhZCBibG9jayByZWZlcmVuY2UgaW4gYWRkciAweCR7dC50b1N0cmluZygxNikucGFkU3RhcnQoNjQsIjAiKX1gKTtsZXQgYT10aGlzLiNzLmRlY29kZShzLmJ1ZmZlcik7dGhpcy4jbi5kZWJ1ZyhhKX0sbG9nX2Vycm9yOnQ9PntsZXQgZT1wLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtlXTtpZighcylyZXR1cm4gdGhpcy4jbi5lcnJvcihgZmFpbGVkIHRvIGxvZyhlcnJvcik6IGJhZCBibG9jayByZWZlcmVuY2UgaW4gYWRkciAweCR7dC50b1N0cmluZygxNikucGFkU3RhcnQoNjQsIjAiKX1gKTtsZXQgYT10aGlzLiNzLmRlY29kZShzLmJ1ZmZlcik7dGhpcy4jbi5lcnJvcihhKX19O3RoaXMuI289dCx0aGlzLiNuPWUsdGhpcy4jcz1uZXcgVGV4dERlY29kZXIsdGhpcy4jaT1uZXcgVGV4dEVuY29kZXIsdGhpcy4jZT1bXSx0aGlzLmFsbG9jKDEpLHRoaXMuI2E9c30jZTsjdDsjbjsjczsjaTsjbzsjYTsjcjthbGxvYyh0KXtsZXQgZT1uZXcgcChuZXcgdGhpcy4jbyhOdW1iZXIodCkpLCEwKSxzPXRoaXMuI3QubGVuZ3RoO3JldHVybiB0aGlzLiN0LnB1c2goZSkscC5pbmRleFRvQWRkcmVzcyhzKX1nZXRWYXJpYWJsZSh0KXtyZXR1cm4gdGhpcy4jci5oYXModCk/dGhpcy5yZWFkKHRoaXMuI3IuZ2V0KHQpKTpudWxsfXNldFZhcmlhYmxlKHQsZSl7bGV0IHM9dGhpc1tMXShlKTtpZihzPT09bnVsbClyZXR1cm4gMG47bGV0IGE9dGhpcy4jci5nZXQodCk/P251bGw7cmV0dXJuIGEhPT1udWxsJiYodGhpcy4jdFthXT10aGlzLiN0W3NdLHRoaXMuI3Rbc109bnVsbCxzPT09dGhpcy4jdC5sZW5ndGgtMSYmdGhpcy4jdC5wb3AoKSksdGhpcy4jci5zZXQodCxhPz9zKSxwLmluZGV4VG9BZGRyZXNzKGE/P3MpfXJlYWQodCl7bGV0IGU9cC5hZGRyZXNzVG9JbmRleCh0KSxzPXRoaXMuI3RbZV07aWYoIXMpcmV0dXJuIG51bGw7bGV0IGE9IShzLmJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSYmIW90LmFsbG93U2hhcmVkQnVmZmVyQ29kZWM/bmV3IFVpbnQ4QXJyYXkocy5idWZmZXIpLnNsaWNlKCkuYnVmZmVyOnMuYnVmZmVyO3JldHVybiBuZXcgeShhKX1zdG9yZSh0KXtsZXQgZT10aGlzW0xdKHQpO2lmKCFlKXRocm93IG5ldyBFcnJvcigiZmFpbGVkIHRvIHN0b3JlIG91dHB1dCIpO3JldHVybiBwLmluZGV4VG9BZGRyZXNzKGUpfWxlbmd0aCh0KXtsZXQgZT1wLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtlXTtyZXR1cm4gcz9CaWdJbnQocy5idWZmZXIuYnl0ZUxlbmd0aCk6MG59Z2V0I2woKXtsZXQgdD10aGlzLiNlW3RoaXMuI2UubGVuZ3RoLTFdWzBdO3JldHVybiB0PT09bnVsbD9udWxsOnRoaXMuI3RbdF19WyhidD1LLFgpXSgpe3RoaXMuI3QubGVuZ3RoPTEsdGhpcy4jZS5sZW5ndGg9MH1bal0odCl7bGV0IGU9dGhpcy4jdFt0XTtpZighZSl0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgYmxvY2sgaW5kZXg6ICR7dH1gKTtyZXR1cm4gZX1ba10odCxlPSExKXtmb3IobGV0W3MsYV1vZiB0LmJsb2Nrcyl7aWYocyYmZSl7bGV0IG49bmV3IFVpbnQ4QXJyYXkobmV3IHRoaXMuI28oTnVtYmVyKHMuYnl0ZUxlbmd0aCkpKTtuLnNldChuZXcgVWludDhBcnJheShzKSkscz1uLmJ1ZmZlcn10aGlzLiN0W2FdPXM/bmV3IHAocywhMSk6bnVsbH10aGlzLiNlPXQuc3RhY2t9W0JdKCl7cmV0dXJue3N0YWNrOnRoaXMuI2Uuc2xpY2UoKSxibG9ja3M6dGhpcy4jdC5tYXAoKHQsZSk9PnQ/dC5sb2NhbD8odC5sb2NhbD0hMSxbdC5idWZmZXIsZV0pOm51bGw6W251bGwsZV0pLmZpbHRlcihCb29sZWFuKX19W0xdKHQpe2lmKCF0KXJldHVybiBudWxsO2lmKHR5cGVvZiB0PT0ic3RyaW5nIiYmKHQ9dGhpcy4jaS5lbmNvZGUodCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtpZih0LmJ1ZmZlci5jb25zdHJ1Y3Rvcj09PXRoaXMuI28pe2xldCBuPXRoaXMuI3QubGVuZ3RoO3JldHVybiB0aGlzLiN0LnB1c2gobmV3IHAodC5idWZmZXIsITApKSxufWxldCBlPXAuYWRkcmVzc1RvSW5kZXgodGhpcy5hbGxvYyh0Lmxlbmd0aCkpLHM9dGhpcy4jdFtlXTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocy5idWZmZXIpLnNldCh0LDApLGV9cmV0dXJuIHR9W3pdKHQpe3RoaXMuI2UucHVzaChbdCxudWxsLG51bGxdKX1bUF0oKXtsZXRbLHQsZV09dGhpcy4jZS5wb3AoKSxzPWU9PT1udWxsPzE6MCxhPWU/P3Qsbj1bbnVsbCxudWxsXTtyZXR1cm4gYT09PW51bGx8fHRoaXMuI3RbYV09PT1udWxsfHwobltzXT1hKSxufX07dmFyIHg9Y2xhc3N7c3RhdGljIHJlYWRfYnl0ZXModCxlKXtsZXQgcz1uZXcgeDtyZXR1cm4gcy5idWY9dC5nZXRVaW50MzIoZSwhMCkscy5idWZfbGVuPXQuZ2V0VWludDMyKGUrNCwhMCksc31zdGF0aWMgcmVhZF9ieXRlc19hcnJheSh0LGUscyl7bGV0IGE9W107Zm9yKGxldCBuPTA7bjxzO24rKylhLnB1c2goeC5yZWFkX2J5dGVzKHQsZSs4Km4pKTtyZXR1cm4gYX19LE89Y2xhc3N7c3RhdGljIHJlYWRfYnl0ZXModCxlKXtsZXQgcz1uZXcgTztyZXR1cm4gcy5idWY9dC5nZXRVaW50MzIoZSwhMCkscy5idWZfbGVuPXQuZ2V0VWludDMyKGUrNCwhMCksc31zdGF0aWMgcmVhZF9ieXRlc19hcnJheSh0LGUscyl7bGV0IGE9W107Zm9yKGxldCBuPTA7bjxzO24rKylhLnB1c2goTy5yZWFkX2J5dGVzKHQsZSs4Km4pKTtyZXR1cm4gYX19LGF0PTAsbHQ9MSwkPTI7dmFyIFE9NDt2YXIgZnQ9MTw8MCxQdD0xPDwxLGt0PTE8PDIsQnQ9MTw8MyxHdD0xPDw0LEc9Y2xhc3N7d3JpdGVfYnl0ZXModCxlKXt0LnNldFVpbnQ4KGUsdGhpcy5mc19maWxldHlwZSksdC5zZXRVaW50MTYoZSsyLHRoaXMuZnNfZmxhZ3MsITApLHQuc2V0QmlnVWludDY0KGUrOCx0aGlzLmZzX3JpZ2h0c19iYXNlLCEwKSx0LnNldEJpZ1VpbnQ2NChlKzE2LHRoaXMuZnNfcmlnaHRzX2luaGVyaXRlZCwhMCl9Y29uc3RydWN0b3IodCxlKXt0aGlzLmZzX3JpZ2h0c19iYXNlPTBuLHRoaXMuZnNfcmlnaHRzX2luaGVyaXRlZD0wbix0aGlzLmZzX2ZpbGV0eXBlPXQsdGhpcy5mc19mbGFncz1lfX0sTXQ9MTw8MCxXdD0xPDwxLEh0PTE8PDIsdnQ9MTw8MyxFdD0xPDwwLFJ0PTE8PDEsd3Q9MTw8MixtdD0xPDwzLE09Y2xhc3N7d3JpdGVfYnl0ZXModCxlKXt0LnNldEJpZ1VpbnQ2NChlLHRoaXMuZGV2LCEwKSx0LnNldEJpZ1VpbnQ2NChlKzgsdGhpcy5pbm8sITApLHQuc2V0VWludDgoZSsxNix0aGlzLmZpbGV0eXBlKSx0LnNldEJpZ1VpbnQ2NChlKzI0LHRoaXMubmxpbmssITApLHQuc2V0QmlnVWludDY0KGUrMzIsdGhpcy5zaXplLCEwKSx0LnNldEJpZ1VpbnQ2NChlKzM4LHRoaXMuYXRpbSwhMCksdC5zZXRCaWdVaW50NjQoZSs0Nix0aGlzLm10aW0sITApLHQuc2V0QmlnVWludDY0KGUrNTIsdGhpcy5jdGltLCEwKX1jb25zdHJ1Y3Rvcih0LGUpe3RoaXMuZGV2PTBuLHRoaXMuaW5vPTBuLHRoaXMubmxpbms9MG4sdGhpcy5hdGltPTBuLHRoaXMubXRpbT0wbix0aGlzLmN0aW09MG4sdGhpcy5maWxldHlwZT10LHRoaXMuc2l6ZT1lfX07dmFyIFZ0PTE8PDAsWXQ9MTw8MDt2YXIgenQ9MTw8MCxLdD0xPDwxLGp0PTE8PDAsWHQ9MTw8MCwkdD0xPDwxO3ZhciB4dD1jbGFzc3tlbmFibGUodCl7dGhpcy5sb2c9T3QodD09PXZvaWQgMD8hMDp0LHRoaXMucHJlZml4KX1nZXQgZW5hYmxlZCgpe3JldHVybiB0aGlzLmlzRW5hYmxlZH1jb25zdHJ1Y3Rvcih0KXt0aGlzLmlzRW5hYmxlZD10LHRoaXMucHJlZml4PSJ3YXNpOiIsdGhpcy5lbmFibGUodCl9fTtmdW5jdGlvbiBPdChjLHQpe3JldHVybiBjP2NvbnNvbGUubG9nLmJpbmQoY29uc29sZSwiJWMlcyIsImNvbG9yOiAjMjY1QkEwIix0KTooKT0+e319dmFyIHc9bmV3IHh0KCExKTt2YXIgSD1jbGFzcyBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQpe3N1cGVyKCJleGl0IHdpdGggZXhpdCBjb2RlICIrdCksdGhpcy5jb2RlPXR9fSxxPWNsYXNze3N0YXJ0KHQpe3RoaXMuaW5zdD10O3RyeXt0LmV4cG9ydHMuX3N0YXJ0KCl9Y2F0Y2goZSl7aWYoZSBpbnN0YW5jZW9mIEgpcmV0dXJuIGUuY29kZTt0aHJvdyBlfX1pbml0aWFsaXplKHQpe3RoaXMuaW5zdD10LHQuZXhwb3J0cy5faW5pdGlhbGl6ZSgpfWNvbnN0cnVjdG9yKHQsZSxzLGE9e30pe3RoaXMuYXJncz1bXSx0aGlzLmVudj1bXSx0aGlzLmZkcz1bXSx3LmVuYWJsZShhLmRlYnVnKSx0aGlzLmFyZ3M9dCx0aGlzLmVudj1lLHRoaXMuZmRzPXM7bGV0IG49dGhpczt0aGlzLndhc2lJbXBvcnQ9e2FyZ3Nfc2l6ZXNfZ2V0KHIsaSl7bGV0IG89bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO28uc2V0VWludDMyKHIsbi5hcmdzLmxlbmd0aCwhMCk7bGV0IGw9MDtmb3IobGV0IGYgb2Ygbi5hcmdzKWwrPWYubGVuZ3RoKzE7cmV0dXJuIG8uc2V0VWludDMyKGksbCwhMCksdy5sb2coby5nZXRVaW50MzIociwhMCksby5nZXRVaW50MzIoaSwhMCkpLDB9LGFyZ3NfZ2V0KHIsaSl7bGV0IG89bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGw9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksZj1pO2ZvcihsZXQgdT0wO3U8bi5hcmdzLmxlbmd0aDt1Kyspe28uc2V0VWludDMyKHIsaSwhMCkscis9NDtsZXQgXz1uZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUobi5hcmdzW3VdKTtsLnNldChfLGkpLG8uc2V0VWludDgoaStfLmxlbmd0aCwwKSxpKz1fLmxlbmd0aCsxfXJldHVybiB3LmVuYWJsZWQmJncubG9nKG5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUobC5zbGljZShmLGkpKSksMH0sZW52aXJvbl9zaXplc19nZXQocixpKXtsZXQgbz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7by5zZXRVaW50MzIocixuLmVudi5sZW5ndGgsITApO2xldCBsPTA7Zm9yKGxldCBmIG9mIG4uZW52KWwrPWYubGVuZ3RoKzE7cmV0dXJuIG8uc2V0VWludDMyKGksbCwhMCksdy5sb2coby5nZXRVaW50MzIociwhMCksby5nZXRVaW50MzIoaSwhMCkpLDB9LGVudmlyb25fZ2V0KHIsaSl7bGV0IG89bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGw9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksZj1pO2ZvcihsZXQgdT0wO3U8bi5lbnYubGVuZ3RoO3UrKyl7by5zZXRVaW50MzIocixpLCEwKSxyKz00O2xldCBfPW5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShuLmVudlt1XSk7bC5zZXQoXyxpKSxvLnNldFVpbnQ4KGkrXy5sZW5ndGgsMCksaSs9Xy5sZW5ndGgrMX1yZXR1cm4gdy5lbmFibGVkJiZ3LmxvZyhuZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGwuc2xpY2UoZixpKSkpLDB9LGNsb2NrX3Jlc19nZXQocixpKXtsZXQgbztzd2l0Y2gocil7Y2FzZSAxOntvPTUwMDBuO2JyZWFrfWNhc2UgMDp7bz0xMDAwMDAwbjticmVha31kZWZhdWx0OnJldHVybiA1Mn1yZXR1cm4gbmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLnNldEJpZ1VpbnQ2NChpLG8sITApLDB9LGNsb2NrX3RpbWVfZ2V0KHIsaSxvKXtsZXQgbD1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYocj09PTApbC5zZXRCaWdVaW50NjQobyxCaWdJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkpKjEwMDAwMDBuLCEwKTtlbHNlIGlmKHI9PTEpe2xldCBmO3RyeXtmPUJpZ0ludChNYXRoLnJvdW5kKHBlcmZvcm1hbmNlLm5vdygpKjFlNikpfWNhdGNoe2Y9MG59bC5zZXRCaWdVaW50NjQobyxmLCEwKX1lbHNlIGwuc2V0QmlnVWludDY0KG8sMG4sITApO3JldHVybiAwfSxmZF9hZHZpc2UocixpLG8sbCl7cmV0dXJuIG4uZmRzW3JdIT1udWxsP24uZmRzW3JdLmZkX2FkdmlzZShpLG8sbCk6OH0sZmRfYWxsb2NhdGUocixpLG8pe3JldHVybiBuLmZkc1tyXSE9bnVsbD9uLmZkc1tyXS5mZF9hbGxvY2F0ZShpLG8pOjh9LGZkX2Nsb3NlKHIpe2lmKG4uZmRzW3JdIT1udWxsKXtsZXQgaT1uLmZkc1tyXS5mZF9jbG9zZSgpO3JldHVybiBuLmZkc1tyXT12b2lkIDAsaX1lbHNlIHJldHVybiA4fSxmZF9kYXRhc3luYyhyKXtyZXR1cm4gbi5mZHNbcl0hPW51bGw/bi5mZHNbcl0uZmRfZGF0YXN5bmMoKTo4fSxmZF9mZHN0YXRfZ2V0KHIsaSl7aWYobi5mZHNbcl0hPW51bGwpe2xldHtyZXQ6byxmZHN0YXQ6bH09bi5mZHNbcl0uZmRfZmRzdGF0X2dldCgpO3JldHVybiBsPy53cml0ZV9ieXRlcyhuZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksaSksb31lbHNlIHJldHVybiA4fSxmZF9mZHN0YXRfc2V0X2ZsYWdzKHIsaSl7cmV0dXJuIG4uZmRzW3JdIT1udWxsP24uZmRzW3JdLmZkX2Zkc3RhdF9zZXRfZmxhZ3MoaSk6OH0sZmRfZmRzdGF0X3NldF9yaWdodHMocixpLG8pe3JldHVybiBuLmZkc1tyXSE9bnVsbD9uLmZkc1tyXS5mZF9mZHN0YXRfc2V0X3JpZ2h0cyhpLG8pOjh9LGZkX2ZpbGVzdGF0X2dldChyLGkpe2lmKG4uZmRzW3JdIT1udWxsKXtsZXR7cmV0Om8sZmlsZXN0YXQ6bH09bi5mZHNbcl0uZmRfZmlsZXN0YXRfZ2V0KCk7cmV0dXJuIGw/LndyaXRlX2J5dGVzKG5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxpKSxvfWVsc2UgcmV0dXJuIDh9LGZkX2ZpbGVzdGF0X3NldF9zaXplKHIsaSl7cmV0dXJuIG4uZmRzW3JdIT1udWxsP24uZmRzW3JdLmZkX2ZpbGVzdGF0X3NldF9zaXplKGkpOjh9LGZkX2ZpbGVzdGF0X3NldF90aW1lcyhyLGksbyxsKXtyZXR1cm4gbi5mZHNbcl0hPW51bGw/bi5mZHNbcl0uZmRfZmlsZXN0YXRfc2V0X3RpbWVzKGksbyxsKTo4fSxmZF9wcmVhZChyLGksbyxsLGYpe2xldCB1PW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxfPW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3JdIT1udWxsKXtsZXQgZD14LnJlYWRfYnl0ZXNfYXJyYXkodSxpLG8pLHtyZXQ6RSxucmVhZDpifT1uLmZkc1tyXS5mZF9wcmVhZChfLGQsbCk7cmV0dXJuIHUuc2V0VWludDMyKGYsYiwhMCksRX1lbHNlIHJldHVybiA4fSxmZF9wcmVzdGF0X2dldChyLGkpe2xldCBvPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tyXSE9bnVsbCl7bGV0e3JldDpsLHByZXN0YXQ6Zn09bi5mZHNbcl0uZmRfcHJlc3RhdF9nZXQoKTtyZXR1cm4gZj8ud3JpdGVfYnl0ZXMobyxpKSxsfWVsc2UgcmV0dXJuIDh9LGZkX3ByZXN0YXRfZGlyX25hbWUocixpLG8pe2lmKG4uZmRzW3JdIT1udWxsKXtsZXR7cmV0OmwscHJlc3RhdF9kaXJfbmFtZTpmfT1uLmZkc1tyXS5mZF9wcmVzdGF0X2Rpcl9uYW1lKCk7cmV0dXJuIGYhPW51bGwmJm5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLnNldChmLGkpLGx9ZWxzZSByZXR1cm4gOH0sZmRfcHdyaXRlKHIsaSxvLGwsZil7bGV0IHU9bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLF89bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbcl0hPW51bGwpe2xldCBkPU8ucmVhZF9ieXRlc19hcnJheSh1LGksbykse3JldDpFLG53cml0dGVuOmJ9PW4uZmRzW3JdLmZkX3B3cml0ZShfLGQsbCk7cmV0dXJuIHUuc2V0VWludDMyKGYsYiwhMCksRX1lbHNlIHJldHVybiA4fSxmZF9yZWFkKHIsaSxvLGwpe2xldCBmPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSx1PW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3JdIT1udWxsKXtsZXQgXz14LnJlYWRfYnl0ZXNfYXJyYXkoZixpLG8pLHtyZXQ6ZCxucmVhZDpFfT1uLmZkc1tyXS5mZF9yZWFkKHUsXyk7cmV0dXJuIGYuc2V0VWludDMyKGwsRSwhMCksZH1lbHNlIHJldHVybiA4fSxmZF9yZWFkZGlyKHIsaSxvLGwsZil7bGV0IHU9bmV3IERhdGFWaWV3KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLF89bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbcl0hPW51bGwpe2xldCBkPTA7Zm9yKDs7KXtsZXR7cmV0OkUsZGlyZW50OmJ9PW4uZmRzW3JdLmZkX3JlYWRkaXJfc2luZ2xlKGwpO2lmKEUhPTApcmV0dXJuIHUuc2V0VWludDMyKGYsZCwhMCksRTtpZihiPT1udWxsKWJyZWFrO2lmKG8tZDxiLmhlYWRfbGVuZ3RoKCkpe2Q9bzticmVha31sZXQgbT1uZXcgQXJyYXlCdWZmZXIoYi5oZWFkX2xlbmd0aCgpKTtpZihiLndyaXRlX2hlYWRfYnl0ZXMobmV3IERhdGFWaWV3KG0pLDApLF8uc2V0KG5ldyBVaW50OEFycmF5KG0pLnNsaWNlKDAsTWF0aC5taW4obS5ieXRlTGVuZ3RoLG8tZCkpLGkpLGkrPWIuaGVhZF9sZW5ndGgoKSxkKz1iLmhlYWRfbGVuZ3RoKCksby1kPGIubmFtZV9sZW5ndGgoKSl7ZD1vO2JyZWFrfWIud3JpdGVfbmFtZV9ieXRlcyhfLGksby1kKSxpKz1iLm5hbWVfbGVuZ3RoKCksZCs9Yi5uYW1lX2xlbmd0aCgpLGw9Yi5kX25leHR9cmV0dXJuIHUuc2V0VWludDMyKGYsZCwhMCksMH1lbHNlIHJldHVybiA4fSxmZF9yZW51bWJlcihyLGkpe2lmKG4uZmRzW3JdIT1udWxsJiZuLmZkc1tpXSE9bnVsbCl7bGV0IG89bi5mZHNbaV0uZmRfY2xvc2UoKTtyZXR1cm4gbyE9MD9vOihuLmZkc1tpXT1uLmZkc1tyXSxuLmZkc1tyXT12b2lkIDAsMCl9ZWxzZSByZXR1cm4gOH0sZmRfc2VlayhyLGksbyxsKXtsZXQgZj1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbcl0hPW51bGwpe2xldHtyZXQ6dSxvZmZzZXQ6X309bi5mZHNbcl0uZmRfc2VlayhpLG8pO3JldHVybiBmLnNldEJpZ0ludDY0KGwsXywhMCksdX1lbHNlIHJldHVybiA4fSxmZF9zeW5jKHIpe3JldHVybiBuLmZkc1tyXSE9bnVsbD9uLmZkc1tyXS5mZF9zeW5jKCk6OH0sZmRfdGVsbChyLGkpe2xldCBvPW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tyXSE9bnVsbCl7bGV0e3JldDpsLG9mZnNldDpmfT1uLmZkc1tyXS5mZF90ZWxsKCk7cmV0dXJuIG8uc2V0QmlnVWludDY0KGksZiwhMCksbH1lbHNlIHJldHVybiA4fSxmZF93cml0ZShyLGksbyxsKXtsZXQgZj1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksdT1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tyXSE9bnVsbCl7bGV0IF89Ty5yZWFkX2J5dGVzX2FycmF5KGYsaSxvKSx7cmV0OmQsbndyaXR0ZW46RX09bi5mZHNbcl0uZmRfd3JpdGUodSxfKTtyZXR1cm4gZi5zZXRVaW50MzIobCxFLCEwKSxkfWVsc2UgcmV0dXJuIDh9LHBhdGhfY3JlYXRlX2RpcmVjdG9yeShyLGksbyl7bGV0IGw9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbcl0hPW51bGwpe2xldCBmPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUobC5zbGljZShpLGkrbykpO3JldHVybiBuLmZkc1tyXS5wYXRoX2NyZWF0ZV9kaXJlY3RvcnkoZil9fSxwYXRoX2ZpbGVzdGF0X2dldChyLGksbyxsLGYpe2xldCB1PW5ldyBEYXRhVmlldyhuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxfPW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3JdIT1udWxsKXtsZXQgZD1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKF8uc2xpY2UobyxvK2wpKSx7cmV0OkUsZmlsZXN0YXQ6Yn09bi5mZHNbcl0ucGF0aF9maWxlc3RhdF9nZXQoaSxkKTtyZXR1cm4gYj8ud3JpdGVfYnl0ZXModSxmKSxFfWVsc2UgcmV0dXJuIDh9LHBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzKHIsaSxvLGwsZix1LF8pe2xldCBkPW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3JdIT1udWxsKXtsZXQgRT1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGQuc2xpY2UobyxvK2wpKTtyZXR1cm4gbi5mZHNbcl0ucGF0aF9maWxlc3RhdF9zZXRfdGltZXMoaSxFLGYsdSxfKX1lbHNlIHJldHVybiA4fSxwYXRoX2xpbmsocixpLG8sbCxmLHUsXyl7bGV0IGQ9bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYobi5mZHNbcl0hPW51bGwmJm4uZmRzW2ZdIT1udWxsKXtsZXQgRT1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGQuc2xpY2UobyxvK2wpKSxiPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoZC5zbGljZSh1LHUrXykpO3JldHVybiBuLmZkc1tmXS5wYXRoX2xpbmsocixpLEUsYil9ZWxzZSByZXR1cm4gOH0scGF0aF9vcGVuKHIsaSxvLGwsZix1LF8sZCxFKXtsZXQgYj1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksbT1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tyXSE9bnVsbCl7bGV0IGV0PW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUobS5zbGljZShvLG8rbCkpO3cubG9nKGV0KTtsZXR7cmV0Om50LGZkX29iajpwdH09bi5mZHNbcl0ucGF0aF9vcGVuKGksZXQsZix1LF8sZCk7aWYobnQhPTApcmV0dXJuIG50O24uZmRzLnB1c2gocHQpO2xldCBndD1uLmZkcy5sZW5ndGgtMTtyZXR1cm4gYi5zZXRVaW50MzIoRSxndCwhMCksMH1lbHNlIHJldHVybiA4fSxwYXRoX3JlYWRsaW5rKHIsaSxvLGwsZix1KXtsZXQgXz1uZXcgRGF0YVZpZXcobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksZD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tyXSE9bnVsbCl7bGV0IEU9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShkLnNsaWNlKGksaStvKSk7dy5sb2coRSk7bGV0e3JldDpiLGRhdGE6bX09bi5mZHNbcl0ucGF0aF9yZWFkbGluayhFKTtpZihtIT1udWxsKXtpZihtLmxlbmd0aD5mKXJldHVybiBfLnNldFVpbnQzMih1LDAsITApLDg7ZC5zZXQobSxsKSxfLnNldFVpbnQzMih1LG0ubGVuZ3RoLCEwKX1yZXR1cm4gYn1lbHNlIHJldHVybiA4fSxwYXRoX3JlbW92ZV9kaXJlY3RvcnkocixpLG8pe2xldCBsPW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW3JdIT1udWxsKXtsZXQgZj1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGwuc2xpY2UoaSxpK28pKTtyZXR1cm4gbi5mZHNbcl0ucGF0aF9yZW1vdmVfZGlyZWN0b3J5KGYpfWVsc2UgcmV0dXJuIDh9LHBhdGhfcmVuYW1lKHIsaSxvLGwsZix1KXt0aHJvdyJGSVhNRSB3aGF0IGlzIHRoZSBiZXN0IGFic3RyYWN0aW9uIGZvciB0aGlzPyJ9LHBhdGhfc3ltbGluayhyLGksbyxsLGYpe2xldCB1PW5ldyBVaW50OEFycmF5KG4uaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG4uZmRzW29dIT1udWxsKXtsZXQgXz1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKHUuc2xpY2UocixyK2kpKSxkPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUodS5zbGljZShsLGwrZikpO3JldHVybiBuLmZkc1tvXS5wYXRoX3N5bWxpbmsoXyxkKX1lbHNlIHJldHVybiA4fSxwYXRoX3VubGlua19maWxlKHIsaSxvKXtsZXQgbD1uZXcgVWludDhBcnJheShuLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihuLmZkc1tyXSE9bnVsbCl7bGV0IGY9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShsLnNsaWNlKGksaStvKSk7cmV0dXJuIG4uZmRzW3JdLnBhdGhfdW5saW5rX2ZpbGUoZil9ZWxzZSByZXR1cm4gOH0scG9sbF9vbmVvZmYocixpLG8pe3Rocm93ImFzeW5jIGlvIG5vdCBzdXBwb3J0ZWQifSxwcm9jX2V4aXQocil7dGhyb3cgbmV3IEgocil9LHByb2NfcmFpc2Uocil7dGhyb3cicmFpc2VkIHNpZ25hbCAiK3J9LHNjaGVkX3lpZWxkKCl7fSxyYW5kb21fZ2V0KHIsaSl7bGV0IG89bmV3IFVpbnQ4QXJyYXkobi5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7Zm9yKGxldCBsPTA7bDxpO2wrKylvW3IrbF09TWF0aC5yYW5kb20oKSoyNTZ8MH0sc29ja19yZWN2KHIsaSxvKXt0aHJvdyJzb2NrZXRzIG5vdCBzdXBwb3J0ZWQifSxzb2NrX3NlbmQocixpLG8pe3Rocm93InNvY2tldHMgbm90IHN1cHBvcnRlZCJ9LHNvY2tfc2h1dGRvd24ocixpKXt0aHJvdyJzb2NrZXRzIG5vdCBzdXBwb3J0ZWQifSxzb2NrX2FjY2VwdChyLGkpe3Rocm93InNvY2tldHMgbm90IHN1cHBvcnRlZCJ9fX19O3ZhciBBPWNsYXNze2ZkX2FkdmlzZSh0LGUscyl7cmV0dXJuIDU4fWZkX2FsbG9jYXRlKHQsZSl7cmV0dXJuIDU4fWZkX2Nsb3NlKCl7cmV0dXJuIDB9ZmRfZGF0YXN5bmMoKXtyZXR1cm4gNTh9ZmRfZmRzdGF0X2dldCgpe3JldHVybntyZXQ6NTgsZmRzdGF0Om51bGx9fWZkX2Zkc3RhdF9zZXRfZmxhZ3ModCl7cmV0dXJuIDU4fWZkX2Zkc3RhdF9zZXRfcmlnaHRzKHQsZSl7cmV0dXJuIDU4fWZkX2ZpbGVzdGF0X2dldCgpe3JldHVybntyZXQ6NTgsZmlsZXN0YXQ6bnVsbH19ZmRfZmlsZXN0YXRfc2V0X3NpemUodCl7cmV0dXJuIDU4fWZkX2ZpbGVzdGF0X3NldF90aW1lcyh0LGUscyl7cmV0dXJuIDU4fWZkX3ByZWFkKHQsZSxzKXtyZXR1cm57cmV0OjU4LG5yZWFkOjB9fWZkX3ByZXN0YXRfZ2V0KCl7cmV0dXJue3JldDo1OCxwcmVzdGF0Om51bGx9fWZkX3ByZXN0YXRfZGlyX25hbWUoKXtyZXR1cm57cmV0OjU4LHByZXN0YXRfZGlyX25hbWU6bnVsbH19ZmRfcHdyaXRlKHQsZSxzKXtyZXR1cm57cmV0OjU4LG53cml0dGVuOjB9fWZkX3JlYWQodCxlKXtyZXR1cm57cmV0OjU4LG5yZWFkOjB9fWZkX3JlYWRkaXJfc2luZ2xlKHQpe3JldHVybntyZXQ6NTgsZGlyZW50Om51bGx9fWZkX3NlZWsodCxlKXtyZXR1cm57cmV0OjU4LG9mZnNldDowbn19ZmRfc3luYygpe3JldHVybiAwfWZkX3RlbGwoKXtyZXR1cm57cmV0OjU4LG9mZnNldDowbn19ZmRfd3JpdGUodCxlKXtyZXR1cm57cmV0OjU4LG53cml0dGVuOjB9fXBhdGhfY3JlYXRlX2RpcmVjdG9yeSh0KXtyZXR1cm4gNTh9cGF0aF9maWxlc3RhdF9nZXQodCxlKXtyZXR1cm57cmV0OjU4LGZpbGVzdGF0Om51bGx9fXBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzKHQsZSxzLGEsbil7cmV0dXJuIDU4fXBhdGhfbGluayh0LGUscyxhKXtyZXR1cm4gNTh9cGF0aF9vcGVuKHQsZSxzLGEsbixyKXtyZXR1cm57cmV0OjU4LGZkX29iajpudWxsfX1wYXRoX3JlYWRsaW5rKHQpe3JldHVybntyZXQ6NTgsZGF0YTpudWxsfX1wYXRoX3JlbW92ZV9kaXJlY3RvcnkodCl7cmV0dXJuIDU4fXBhdGhfcmVuYW1lKHQsZSxzKXtyZXR1cm4gNTh9cGF0aF9zeW1saW5rKHQsZSl7cmV0dXJuIDU4fXBhdGhfdW5saW5rX2ZpbGUodCl7cmV0dXJuIDU4fX07dmFyIE49Y2xhc3MgZXh0ZW5kcyBBe2ZkX2Zkc3RhdF9nZXQoKXtyZXR1cm57cmV0OjAsZmRzdGF0Om5ldyBHKFEsMCl9fWZkX3JlYWQodCxlKXtsZXQgcz0wO2ZvcihsZXQgYSBvZiBlKWlmKHRoaXMuZmlsZV9wb3M8dGhpcy5maWxlLmRhdGEuYnl0ZUxlbmd0aCl7bGV0IG49dGhpcy5maWxlLmRhdGEuc2xpY2UoTnVtYmVyKHRoaXMuZmlsZV9wb3MpLE51bWJlcih0aGlzLmZpbGVfcG9zK0JpZ0ludChhLmJ1Zl9sZW4pKSk7dC5zZXQobixhLmJ1ZiksdGhpcy5maWxlX3Bvcys9QmlnSW50KG4ubGVuZ3RoKSxzKz1uLmxlbmd0aH1lbHNlIGJyZWFrO3JldHVybntyZXQ6MCxucmVhZDpzfX1mZF9wcmVhZCh0LGUscyl7bGV0IGE9MDtmb3IobGV0IG4gb2YgZSlpZihzPHRoaXMuZmlsZS5kYXRhLmJ5dGVMZW5ndGgpe2xldCByPXRoaXMuZmlsZS5kYXRhLnNsaWNlKE51bWJlcihzKSxOdW1iZXIocytCaWdJbnQobi5idWZfbGVuKSkpO3Quc2V0KHIsbi5idWYpLHMrPUJpZ0ludChyLmxlbmd0aCksYSs9ci5sZW5ndGh9ZWxzZSBicmVhaztyZXR1cm57cmV0OjAsbnJlYWQ6YX19ZmRfc2Vlayh0LGUpe2xldCBzO3N3aXRjaChlKXtjYXNlIGF0OnM9dDticmVhaztjYXNlIGx0OnM9dGhpcy5maWxlX3Bvcyt0O2JyZWFrO2Nhc2UgJDpzPUJpZ0ludCh0aGlzLmZpbGUuZGF0YS5ieXRlTGVuZ3RoKSt0O2JyZWFrO2RlZmF1bHQ6cmV0dXJue3JldDoyOCxvZmZzZXQ6MG59fXJldHVybiBzPDA/e3JldDoyOCxvZmZzZXQ6MG59Oih0aGlzLmZpbGVfcG9zPXMse3JldDowLG9mZnNldDp0aGlzLmZpbGVfcG9zfSl9ZmRfdGVsbCgpe3JldHVybntyZXQ6MCxvZmZzZXQ6dGhpcy5maWxlX3Bvc319ZmRfd3JpdGUodCxlKXtsZXQgcz0wO2lmKHRoaXMuZmlsZS5yZWFkb25seSlyZXR1cm57cmV0OjgsbndyaXR0ZW46c307Zm9yKGxldCBhIG9mIGUpe2xldCBuPXQuc2xpY2UoYS5idWYsYS5idWYrYS5idWZfbGVuKTtpZih0aGlzLmZpbGVfcG9zK0JpZ0ludChuLmJ5dGVMZW5ndGgpPnRoaXMuZmlsZS5zaXplKXtsZXQgcj10aGlzLmZpbGUuZGF0YTt0aGlzLmZpbGUuZGF0YT1uZXcgVWludDhBcnJheShOdW1iZXIodGhpcy5maWxlX3BvcytCaWdJbnQobi5ieXRlTGVuZ3RoKSkpLHRoaXMuZmlsZS5kYXRhLnNldChyKX10aGlzLmZpbGUuZGF0YS5zZXQobi5zbGljZSgwLE51bWJlcih0aGlzLmZpbGUuc2l6ZS10aGlzLmZpbGVfcG9zKSksTnVtYmVyKHRoaXMuZmlsZV9wb3MpKSx0aGlzLmZpbGVfcG9zKz1CaWdJbnQobi5ieXRlTGVuZ3RoKSxzKz1hLmJ1Zl9sZW59cmV0dXJue3JldDowLG53cml0dGVuOnN9fWZkX3B3cml0ZSh0LGUscyl7bGV0IGE9MDtpZih0aGlzLmZpbGUucmVhZG9ubHkpcmV0dXJue3JldDo4LG53cml0dGVuOmF9O2ZvcihsZXQgbiBvZiBlKXtsZXQgcj10LnNsaWNlKG4uYnVmLG4uYnVmK24uYnVmX2xlbik7aWYocytCaWdJbnQoci5ieXRlTGVuZ3RoKT50aGlzLmZpbGUuc2l6ZSl7bGV0IGk9dGhpcy5maWxlLmRhdGE7dGhpcy5maWxlLmRhdGE9bmV3IFVpbnQ4QXJyYXkoTnVtYmVyKHMrQmlnSW50KHIuYnl0ZUxlbmd0aCkpKSx0aGlzLmZpbGUuZGF0YS5zZXQoaSl9dGhpcy5maWxlLmRhdGEuc2V0KHIuc2xpY2UoMCxOdW1iZXIodGhpcy5maWxlLnNpemUtcykpLE51bWJlcihzKSkscys9QmlnSW50KHIuYnl0ZUxlbmd0aCksYSs9bi5idWZfbGVufXJldHVybntyZXQ6MCxud3JpdHRlbjphfX1mZF9maWxlc3RhdF9nZXQoKXtyZXR1cm57cmV0OjAsZmlsZXN0YXQ6dGhpcy5maWxlLnN0YXQoKX19Y29uc3RydWN0b3IodCl7c3VwZXIoKSx0aGlzLmZpbGVfcG9zPTBuLHRoaXMuZmlsZT10fX07dmFyIFM9Y2xhc3N7b3Blbih0KXtsZXQgZT1uZXcgTih0aGlzKTtyZXR1cm4gdCZmdCYmZS5mZF9zZWVrKDBuLCQpLGV9Z2V0IHNpemUoKXtyZXR1cm4gQmlnSW50KHRoaXMuZGF0YS5ieXRlTGVuZ3RoKX1zdGF0KCl7cmV0dXJuIG5ldyBNKFEsdGhpcy5zaXplKX10cnVuY2F0ZSgpe3JldHVybiB0aGlzLnJlYWRvbmx5PzYzOih0aGlzLmRhdGE9bmV3IFVpbnQ4QXJyYXkoW10pLDApfWNvbnN0cnVjdG9yKHQsZSl7dGhpcy5kYXRhPW5ldyBVaW50OEFycmF5KHQpLHRoaXMucmVhZG9ubHk9ISFlPy5yZWFkb25seX19O3ZhciBDPWNsYXNzIGV4dGVuZHMgQXsjZTtjb25zdHJ1Y3Rvcih0KXtzdXBlcigpLHRoaXMuI2U9dH1mZF93cml0ZSh0LGUpe2xldCBzPTAsYT1uZXcgVGV4dERlY29kZXIsbj1lLnJlZHVjZSgocixpLG8sbCk9PntzKz1pLmJ1Zl9sZW47bGV0IGY9dC5zbGljZShpLmJ1ZixpLmJ1ZitpLmJ1Zl9sZW4pO3JldHVybiByK2EuZGVjb2RlKGYse3N0cmVhbTpvIT09bC5sZW5ndGgtMX0pfSwiIik7cmV0dXJuIGNvbnNvbGVbdGhpcy4jZV0obikse3JldDowLG53cml0dGVuOnN9fX07YXN5bmMgZnVuY3Rpb24gZHQoYyx0KXtsZXQgZT1bXSxzPVtdLGE9dD9bbmV3IEMoImxvZyIpLG5ldyBDKCJsb2ciKSxuZXcgQygiZXJyb3IiKV06W25ldyBOKG5ldyBTKFtdKSksbmV3IE4obmV3IFMoW10pKSxuZXcgTihuZXcgUyhbXSkpXSxuPW5ldyBxKGUscyxhKTtyZXR1cm57YXN5bmMgaW1wb3J0T2JqZWN0KCl7cmV0dXJuIG4ud2FzaUltcG9ydH0sYXN5bmMgY2xvc2UoKXt9LGFzeW5jIGluaXRpYWxpemUocil7bGV0IGk9ci5leHBvcnRzLm1lbW9yeTtpZighaSl0aHJvdyBuZXcgRXJyb3IoIlRoZSBtb2R1bGUgaGFzIHRvIGV4cG9ydCBhIGRlZmF1bHQgbWVtb3J5LiIpO2lmKHIuZXhwb3J0cy5faW5pdGlhbGl6ZSl7bGV0IG89ci5leHBvcnRzLl9pbml0aWFsaXplO24uaW5pdGlhbGl6ZT9uLmluaXRpYWxpemUoe2V4cG9ydHM6e21lbW9yeTppLF9pbml0aWFsaXplOigpPT57bygpfX19KTpvKCl9ZWxzZSBuLnN0YXJ0KHtleHBvcnRzOnttZW1vcnk6aSxfc3RhcnQ6KCk9Pnt9fX0pfX19dmFyIEF0PSJleHRpc206aG9zdC9lbnYiLEo9Y2xhc3N7I2U7I3Q7I247I3M9ITE7I2k7Y29uc3RydWN0b3IodCxlLHMsYSl7dGhpcy4jZT10LHRoaXMuI249ZSx0aGlzLiN0PXMsdGhpcy4jaT1hfWFzeW5jIHJlc2V0KCl7cmV0dXJuIHRoaXMuaXNBY3RpdmUoKT8hMToodGhpcy4jZVtYXSgpLCEwKX1pc0FjdGl2ZSgpe3JldHVybiB0aGlzLiNzfWFzeW5jIGZ1bmN0aW9uRXhpc3RzKHQpe3RyeXtsZXQgZT1bXS5jb25jYXQodCksW3MsYV09ZS5sZW5ndGg9PT0yP1t0aGlzLmxvb2t1cFRhcmdldChlWzBdKSxlWzFdXTpbdGhpcy4jdC5maW5kKHI9PldlYkFzc2VtYmx5Lk1vZHVsZS5leHBvcnRzKHIubW9kdWxlKS5maW5kKG89Pm8ubmFtZT09PWVbMF0mJm8ua2luZD09PSJmdW5jdGlvbiIpKSxlWzBdXTtyZXR1cm4hKCFzfHwhcy5pbnN0YW5jZS5leHBvcnRzW2FdKX1jYXRjaHtyZXR1cm4hMX19YXN5bmMgY2FsbEJsb2NrKHQsZSl7dGhpcy4jcz0hMDtsZXQgcz1bXS5jb25jYXQodCksW2Esbl09cy5sZW5ndGg9PT0yP1t0aGlzLmxvb2t1cFRhcmdldChzWzBdKSxzWzFdXTpbdGhpcy4jdC5maW5kKGk9PldlYkFzc2VtYmx5Lk1vZHVsZS5leHBvcnRzKGkubW9kdWxlKS5maW5kKGw9PmwubmFtZT09PXNbMF0mJmwua2luZD09PSJmdW5jdGlvbiIpKSxzWzBdXTtpZighYSl0aHJvdyBFcnJvcihgUGx1Z2luIGVycm9yOiB0YXJnZXQgIiR7cy5qb2luKCciICInKX0iIGRvZXMgbm90IGV4aXN0YCk7bGV0IHI9YS5pbnN0YW5jZS5leHBvcnRzW25dO2lmKCFyKXRocm93IEVycm9yKGBQbHVnaW4gZXJyb3I6IGZ1bmN0aW9uICIke3Muam9pbignIiAiJyl9IiBkb2VzIG5vdCBleGlzdGApO3RoaXMuI2Vbel0oZT8/bnVsbCk7dHJ5e3JldHVybiByKCksdGhpcy4jZVtQXSgpfWNhdGNoKGkpe3Rocm93IHRoaXMuI2VbUF0oKSxpfWZpbmFsbHl7dGhpcy4jcz0hMX19YXN5bmMgY2FsbCh0LGUpe2xldCBzPXRoaXMuI2VbTF0oZSksW2Esbl09YXdhaXQgdGhpcy5jYWxsQmxvY2sodCxzKSxyPWEhPT1udWxsLGk9YT8/bjtpZihpPT09bnVsbClyZXR1cm4gbnVsbDtsZXQgbz10aGlzLiNlW2pdKGkpO2lmKCFvKXJldHVybiBudWxsO2xldCBsPW5ldyB5KG8uYnVmZmVyKTtpZihyKXRocm93IG5ldyBFcnJvcihgUGx1Z2luLW9yaWdpbmF0ZWQgZXJyb3I6ICR7bC5zdHJpbmcoKX1gKTtyZXR1cm4gbH1sb29rdXBUYXJnZXQodCl7bGV0IGU9U3RyaW5nKHQ/PyIwIikscz10aGlzLiNuLmZpbmRJbmRleChhPT5hPT09ZSk7aWYocz09PS0xKXRocm93IG5ldyBFcnJvcihgbm8gbW9kdWxlIG5hbWVkICIke3R9ImApO3JldHVybiB0aGlzLiN0W3NdfWFzeW5jIGdldEV4cG9ydHModCl7cmV0dXJuIFdlYkFzc2VtYmx5Lk1vZHVsZS5leHBvcnRzKHRoaXMubG9va3VwVGFyZ2V0KHQpLm1vZHVsZSl8fFtdfWFzeW5jIGdldEltcG9ydHModCl7cmV0dXJuIFdlYkFzc2VtYmx5Lk1vZHVsZS5pbXBvcnRzKHRoaXMubG9va3VwVGFyZ2V0KHQpLm1vZHVsZSl8fFtdfWFzeW5jIGdldEluc3RhbmNlKHQpe3JldHVybiB0aGlzLmxvb2t1cFRhcmdldCh0KS5pbnN0YW5jZX1hc3luYyBjbG9zZSgpe3RoaXMuI2kmJihhd2FpdCB0aGlzLiNpLmNsb3NlKCksdGhpcy4jaT1udWxsKX19O2FzeW5jIGZ1bmN0aW9uIGh0KGMsdCxlLHM9bmV3IFQoQXJyYXlCdWZmZXIsYy5sb2dnZXIsYy5jb25maWcpKXtsZXQgYT1jLndhc2lFbmFibGVkP2F3YWl0IGR0KGMuYWxsb3dlZFBhdGhzLGMuZW5hYmxlV2FzaU91dHB1dCk6bnVsbCxuPXsuLi5hP3t3YXNpX3NuYXBzaG90X3ByZXZpZXcxOmF3YWl0IGEuaW1wb3J0T2JqZWN0KCl9Ont9LFtBdF06c1tLXSxlbnY6e319O2ZvcihsZXQgaSBpbiBjLmZ1bmN0aW9ucyl7bltpXT1uW2ldfHx7fTtmb3IobGV0IG8gaW4gYy5mdW5jdGlvbnNbaV0pbltpXVtvXT1jLmZ1bmN0aW9uc1tpXVtvXS5iaW5kKG51bGwscyl9bGV0IHI9YXdhaXQgUHJvbWlzZS5hbGwoZS5tYXAoYXN5bmMgaT0+e2xldCBvPWF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKGksbik7YSYmYXdhaXQgYT8uaW5pdGlhbGl6ZShvKTtsZXQgbD1vLmV4cG9ydHMuaHNfaW5pdD8iaGFza2VsbCI6by5leHBvcnRzLl9pbml0aWFsaXplPyJyZWFjdG9yIjpvLmV4cG9ydHMuX3N0YXJ0PyJjb21tYW5kIjoibm9uZSI7cmV0dXJuKG8uZXhwb3J0cy5oc19pbml0P28uZXhwb3J0cy5oc19pbml0OigpPT57fSkoKSx7bW9kdWxlOmksaW5zdGFuY2U6byxndWVzdFR5cGU6bH19KSk7cmV0dXJuIG5ldyBKKHMsdCxyLGEpfXZhciB2PTVlMyx0dD1jbGFzc3tjb25zdHJ1Y3Rvcih0KXtpZighdCl0aHJvdyBuZXcgRXJyb3IoIlRoaXMgc2hvdWxkIGJlIHVucmVhY2hhYmxlOiB0aGlzIG1vZHVsZSBzaG91bGQgb25seSBiZSBpbnZva2VkIGFzIGEgd2ViIHdvcmtlci4iKTt0aGlzLnNoYXJlZERhdGE9bnVsbCx0aGlzLnNoYXJlZERhdGFWaWV3PW51bGwsdGhpcy5ob3N0RmxhZz1udWxsLHRoaXMucG9ydD10LHRoaXMucG9ydC5vbigibWVzc2FnZSIsZT0+dGhpcy5oYW5kbGVNZXNzYWdlKGUpKSx0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6ImluaXRpYWxpemVkIn0pLHRoaXMuZHluYW1pY0hhbmRsZXJzPW5ldyBNYXAsdGhpcy5keW5hbWljSGFuZGxlcnMuc2V0KCJjYWxsIixhc3luYyhlLHMsYSxuKT0+e2lmKCF0aGlzLmNvbnRleHQpdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHN0YXRlOiBubyBjb250ZXh0IGF2YWlsYWJsZSB0byB3b3JrZXIgcmVhY3RvciIpO3RoaXMuY29udGV4dFtrXShuKTtsZXQgcj1hd2FpdCB0aGlzLnBsdWdpbj8uY2FsbEJsb2NrKHMsYSkudGhlbihpPT5bbnVsbCxpXSxpPT5baSxudWxsXSk7bj10aGlzLmNvbnRleHRbQl0oKTtmb3IobGV0W2ldb2Ygbi5ibG9ja3MpaSYmZS5wdXNoKGkpO3JldHVybiByWzBdJiYoclswXT17b3JpZ2luYWxTdGFjazpyWzBdPy5zdGFjayxtZXNzYWdlOnJbMF0/Lm1lc3NhZ2V9KSx7cmVzdWx0czpyLHN0YXRlOm59fSksdGhpcy5keW5hbWljSGFuZGxlcnMuc2V0KCJyZXNldCIsYXN5bmMgZT0+dGhpcy5wbHVnaW4/LnJlc2V0KCkpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZ2V0RXhwb3J0cyIsYXN5bmMoZSxzKT0+dGhpcy5wbHVnaW4/LmdldEV4cG9ydHMocykpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZ2V0SW1wb3J0cyIsYXN5bmMoZSxzKT0+dGhpcy5wbHVnaW4/LmdldEltcG9ydHMocykpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZnVuY3Rpb25FeGlzdHMiLGFzeW5jKGUscyk9PnRoaXMucGx1Z2luPy5mdW5jdGlvbkV4aXN0cyhzKSl9YXN5bmMgaGFuZGxlTWVzc2FnZSh0KXtzd2l0Y2godC50eXBlKXtjYXNlImluaXQiOnJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUluaXQodCk7Y2FzZSJpbnZva2UiOnJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUludm9rZSh0KX19YXN5bmMgaGFuZGxlSW52b2tlKHQpe2xldCBlPXRoaXMuZHluYW1pY0hhbmRsZXJzLmdldCh0LmhhbmRsZXIpO2lmKCFlKXJldHVybiB0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6InJldHVybiIscmVzdWx0Oltgbm8gaGFuZGxlciByZWdpc3RlcmVkIGZvciAke3QuaGFuZGxlcn1gLG51bGxdfSk7bGV0IHM9W10sYT1hd2FpdCBlKHMsLi4udC5hcmdzfHxbXSkudGhlbihuPT5bbnVsbCxuXSxuPT5bbixudWxsXSk7cmV0dXJuIGFbMF0mJihhWzBdPXtvcmlnaW5hbFN0YWNrOmFbMF0/LnN0YWNrLG1lc3NhZ2U6YVswXT8ubWVzc2FnZX0pLHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToicmV0dXJuIixyZXN1bHRzOmF9LHMpfWFzeW5jIGhhbmRsZUluaXQodCl7dGhpcy5zaGFyZWREYXRhPXQuc2hhcmVkRGF0YSx0aGlzLnNoYXJlZERhdGFWaWV3PW5ldyBEYXRhVmlldyh0LnNoYXJlZERhdGEpLHRoaXMuaG9zdEZsYWc9bmV3IEludDMyQXJyYXkodGhpcy5zaGFyZWREYXRhKTtsZXQgZT1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModC5mdW5jdGlvbnMpLm1hcCgoW2wsZl0pPT5bbCxPYmplY3QuZnJvbUVudHJpZXMoZi5tYXAodT0+W3UsKF8sLi4uZCk9PnRoaXMuY2FsbEhvc3QoXyxsLHUsZCldKSldKSkse3R5cGU6cyxtb2R1bGVzOmEsZnVuY3Rpb25zOm4sLi4ucn09dCxpPWw9PmY9PnRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToibG9nIixsZXZlbDpsLG1lc3NhZ2U6Zn0pLG89T2JqZWN0LmZyb21FbnRyaWVzKFsiaW5mbyIsImRlYnVnIiwid2FybiIsImVycm9yIl0ubWFwKGw9PltsLGkobCldKSk7dGhpcy5jb250ZXh0PW5ldyBUKEFycmF5QnVmZmVyLG8sdC5jb25maWcpLHRoaXMucGx1Z2luPWF3YWl0IGh0KHsuLi5yLGZ1bmN0aW9uczplLGZldGNoLGxvZ2dlcjpvfSx0Lm5hbWVzLGEsdGhpcy5jb250ZXh0KSx0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6InJlYWR5In0pfWNhbGxIb3N0KHQsZSxzLGEpe2lmKCF0aGlzLmhvc3RGbGFnKXRocm93IG5ldyBFcnJvcigiYXR0ZW1wdGVkIHRvIGNhbGwgaG9zdCBiZWZvcmUgcmVjZWl2aW5nIHNoYXJlZCBhcnJheSBidWZmZXIiKTtsZXQgbj10W0JdKCk7dGhpcy5wb3J0LnBvc3RNZXNzYWdlKHt0eXBlOiJpbnZva2UiLG5hbWVzcGFjZTplLGZ1bmM6cyxhcmdzOmEsc3RhdGU6bn0pO2xldCByPW5ldyBJKHRoaXMuc2hhcmVkRGF0YSksaT1bXSxvO2Rve2xldCBsPXIucmVhZFVpbnQ4KCk7c3dpdGNoKGwpe2Nhc2UgMDpyZXR1cm4gbi5ibG9ja3M9aSx0W2tdKG4pLHIuY2xvc2UoKSx0aGlzLmhvc3RGbGFnWzBdPUkuU0FCX0JBU0VfT0ZGU0VULG87Y2FzZSAxOm89ci5yZWFkVWludDY0KCk7YnJlYWs7Y2FzZSAyOm89ci5yZWFkRmxvYXQ2NCgpO2JyZWFrO2Nhc2UgMzpvPXZvaWQgMDticmVhaztjYXNlIDQ6e2xldCBmPXIucmVhZFVpbnQzMigpLHU9ci5yZWFkVWludDMyKCk7aWYoIXUpaS5wdXNoKFtudWxsLGZdKTtlbHNle2xldCBfPW5ldyBVaW50OEFycmF5KHUpO3IucmVhZChfKSxpLnB1c2goW18uYnVmZmVyLGZdKX19YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgc2VjdGlvbiB0eXBlPSIke2x9IjsgcGxlYXNlIG9wZW4gYW4gaXNzdWUgKGh0dHBzOi8vZ2l0aHViLmNvbS9leHRpc20vanMtc2RrL2lzc3Vlcy9uZXc/dGl0bGU9c2hhcmVkK2FycmF5K2J1ZmZlcitiYWQrc2VjdGlvbit0eXBlKyR7bH0mbGFiZWxzPWJ1ZylgKX19d2hpbGUoMSl9fTtuZXcgdHQoaXQpO3ZhciBSPWNsYXNze2NvbnN0cnVjdG9yKHQpe3RoaXMuaW5wdXQ9dCx0aGlzLmlucHV0T2Zmc2V0PVIuU0FCX0JBU0VfT0ZGU0VULHRoaXMuZmxhZz1uZXcgSW50MzJBcnJheSh0aGlzLmlucHV0KSx0aGlzLnNjcmF0Y2g9bmV3IEFycmF5QnVmZmVyKDgpLHRoaXMuc2NyYXRjaFZpZXc9bmV3IERhdGFWaWV3KHRoaXMuc2NyYXRjaCksdGhpcy5leHBlY3RlZD0wLHRoaXMucHVsbCghMSl9Z2V0IGF2YWlsYWJsZSgpe3JldHVybiB0aGlzLmZsYWdbMF0tdGhpcy5pbnB1dE9mZnNldH1jbG9zZSgpe2Zvcig7QXRvbWljcy5jb21wYXJlRXhjaGFuZ2UodGhpcy5mbGFnLFIuU0FCX0lEWCx0aGlzLmV4cGVjdGVkLFIuU0FCX0JBU0VfT0ZGU0VUKSE9PVIuU0FCX0JBU0VfT0ZGU0VUOyk7QXRvbWljcy5ub3RpZnkodGhpcy5mbGFnLFIuU0FCX0lEWCx2KX1wdWxsKHQ9ITApe2lmKHQpe2Zvcig7QXRvbWljcy5jb21wYXJlRXhjaGFuZ2UodGhpcy5mbGFnLFIuU0FCX0lEWCx0aGlzLmV4cGVjdGVkLFIuU0FCX0JBU0VfT0ZGU0VUKSE9PVIuU0FCX0JBU0VfT0ZGU0VUOyk7QXRvbWljcy5ub3RpZnkodGhpcy5mbGFnLFIuU0FCX0lEWCx2KX1sZXQgZT1BdG9taWNzLndhaXQodGhpcy5mbGFnLDAsUi5TQUJfQkFTRV9PRkZTRVQsdik7aWYodGhpcy5leHBlY3RlZD1BdG9taWNzLmxvYWQodGhpcy5mbGFnLDApLGU9PT0idGltZWQtb3V0Iil0aHJvdyBuZXcgRXJyb3IoYFdvcmtlciB0aW1lZCBvdXQgd2FpdGluZyBmb3IgcmVzcG9uc2UgZnJvbSBob3N0IGFmdGVyICR7dn1tcyAke3RoaXMuZmxhZ1swXX1gKTt0aGlzLmlucHV0T2Zmc2V0PVIuU0FCX0JBU0VfT0ZGU0VUfXJlYWQodCl7aWYodC5ieXRlTGVuZ3RoPHRoaXMuYXZhaWxhYmxlKXt0LnNldChuZXcgVWludDhBcnJheSh0aGlzLmlucHV0KS5zdWJhcnJheSh0aGlzLmlucHV0T2Zmc2V0LHRoaXMuaW5wdXRPZmZzZXQrdC5ieXRlTGVuZ3RoKSksdGhpcy5pbnB1dE9mZnNldCs9dC5ieXRlTGVuZ3RoO3JldHVybn1sZXQgZT0wLHM9dGhpcy5hdmFpbGFibGU7ZG97aWYodC5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy5pbnB1dCkuc3ViYXJyYXkodGhpcy5pbnB1dE9mZnNldCx0aGlzLmlucHV0T2Zmc2V0K3MpLGUpLGUrPXMsdGhpcy5pbnB1dE9mZnNldCs9cyxlPT09dC5ieXRlTGVuZ3RofHx0aGlzLmF2YWlsYWJsZTwwKWJyZWFrO3RoaXMucHVsbCgpLHM9TWF0aC5taW4oTWF0aC5tYXgodGhpcy5hdmFpbGFibGUsMCksdC5ieXRlTGVuZ3RoLWUpfXdoaWxlKGUhPT10LmJ5dGVMZW5ndGgpfXJlYWRVaW50OCgpe3JldHVybiB0aGlzLnJlYWQobmV3IFVpbnQ4QXJyYXkodGhpcy5zY3JhdGNoKS5zdWJhcnJheSgwLDEpKSx0aGlzLnNjcmF0Y2hWaWV3LmdldFVpbnQ4KDApfXJlYWRVaW50MzIoKXtyZXR1cm4gdGhpcy5yZWFkKG5ldyBVaW50OEFycmF5KHRoaXMuc2NyYXRjaCkuc3ViYXJyYXkoMCw0KSksdGhpcy5zY3JhdGNoVmlldy5nZXRVaW50MzIoMCwhMCl9cmVhZFVpbnQ2NCgpe3JldHVybiB0aGlzLnJlYWQobmV3IFVpbnQ4QXJyYXkodGhpcy5zY3JhdGNoKSksdGhpcy5zY3JhdGNoVmlldy5nZXRCaWdVaW50NjQoMCwhMCl9cmVhZEZsb2F0NjQoKXtyZXR1cm4gdGhpcy5yZWFkKG5ldyBVaW50OEFycmF5KHRoaXMuc2NyYXRjaCkpLHRoaXMuc2NyYXRjaFZpZXcuZ2V0RmxvYXQ2NCgwLCEwKX19LEk9UjtJLlNBQl9JRFg9MCxJLlNBQl9CQVNFX09GRlNFVD00OwovLyMgc291cmNlTWFwcGluZ1VSTD13b3JrZXIuanMubWFwCg==");var de=new WeakMap,ht=class extends(globalThis.Worker||Object){constructor(t){super(t,{type:"module",credentials:"omit",name:"extism-worker",crossOriginIsolated:!0})}on(t,e){let s=i=>e(i.data);de.set(e,s),this.addEventListener(t,s)}removeListener(t,e){let s=de.get(e);s&&this.removeEventListener(t,s)}once(t,e){let s=this;this.addEventListener(t,function i(...n){s.removeEventListener(t,i),e.call(s,...n)})}};var Ce=ve(xe(),1);var ft=o=>{if(typeof o!="string")throw new TypeError("invalid pattern");if(o.length>65536)throw new TypeError("pattern is too long")};var hs={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},pt=o=>o.replace(/[[\]\\-]/g,"\\$&"),ms=o=>o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),We=o=>o.join(""),Ve=(o,t)=>{let e=t;if(o.charAt(e)!=="[")throw new Error("not in a brace expression");let s=[],i=[],n=e+1,r=!1,l=!1,a=!1,c=!1,d=e,f="";t:for(;n<o.length;){let h=o.charAt(n);if((h==="!"||h==="^")&&n===e+1){c=!0,n++;continue}if(h==="]"&&r&&!a){d=n+1;break}if(r=!0,h==="\\"&&!a){a=!0,n++;continue}if(h==="["&&!a){for(let[y,[X,L,F]]of Object.entries(hs))if(o.startsWith(y,n)){if(f)return["$.",!1,o.length-e,!0];n+=y.length,F?i.push(X):s.push(X),l=l||L;continue t}}if(a=!1,f){h>f?s.push(pt(f)+"-"+pt(h)):h===f&&s.push(pt(h)),f="",n++;continue}if(o.startsWith("-]",n+1)){s.push(pt(h+"-")),n+=2;continue}if(o.startsWith("-",n+1)){f=h,n+=2;continue}s.push(pt(h)),n++}if(d<n)return["",!1,0,!1];if(!s.length&&!i.length)return["$.",!1,o.length-e,!0];if(i.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!c){let h=s[0].length===2?s[0].slice(-1):s[0];return[ms(h),!1,d-e,!1]}let u="["+(c?"^":"")+We(s)+"]",p="["+(c?"":"^")+We(i)+"]";return[s.length&&i.length?"("+u+"|"+p+")":s.length?u:p,l,d-e,!0]};var P=(o,{windowsPathsNoEscape:t=!1}={})=>t?o.replace(/\[([^\/\\])\]/g,"$1"):o.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var fs=new Set(["!","?","+","*","@"]),Ie=o=>fs.has(o),ps="(?!(?:^|/)\\.\\.?(?:$|/))",It="(?!\\.)",bs=new Set(["[","."]),Zs=new Set(["..","."]),ys=new Set("().*{}+?[]^$\\!"),Gs=o=>o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),At="[^/]",we=At+"*?",Ne=At+"+?",I,w,H,g,W,v,et,D,K,st,bt,Nt,Le,it,wt,Zt,Jt,Lt,Se,S=class{constructor(t,e,s={}){V(this,Nt);V(this,Zt);$t(this,"type");V(this,I,void 0);V(this,w,void 0);V(this,H,!1);V(this,g,[]);V(this,W,void 0);V(this,v,void 0);V(this,et,void 0);V(this,D,!1);V(this,K,void 0);V(this,st,void 0);V(this,bt,!1);this.type=t,t&&x(this,w,!0),x(this,W,e),x(this,I,m(this,W)?m(m(this,W),I):this),x(this,K,m(this,I)===this?s:m(m(this,I),K)),x(this,et,m(this,I)===this?[]:m(m(this,I),et)),t==="!"&&!m(m(this,I),D)&&m(this,et).push(this),x(this,v,m(this,W)?m(m(this,W),g).length:0)}get hasMagic(){if(m(this,w)!==void 0)return m(this,w);for(let t of m(this,g))if(typeof t!="string"&&(t.type||t.hasMagic))return x(this,w,!0);return m(this,w)}toString(){return m(this,st)!==void 0?m(this,st):this.type?x(this,st,this.type+"("+m(this,g).map(t=>String(t)).join("|")+")"):x(this,st,m(this,g).map(t=>String(t)).join(""))}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof S&&m(e,W)===this))throw new Error("invalid part: "+e);m(this,g).push(e)}}toJSON(){let t=this.type===null?m(this,g).slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...m(this,g).map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===m(this,I)||m(m(this,I),D)&&m(this,W)?.type==="!")&&t.push({}),t}isStart(){if(m(this,I)===this)return!0;if(!m(this,W)?.isStart())return!1;if(m(this,v)===0)return!0;let t=m(this,W);for(let e=0;e<m(this,v);e++){let s=m(t,g)[e];if(!(s instanceof S&&s.type==="!"))return!1}return!0}isEnd(){if(m(this,I)===this||m(this,W)?.type==="!")return!0;if(!m(this,W)?.isEnd())return!1;if(!this.type)return m(this,W)?.isEnd();let t=m(this,W)?m(m(this,W),g).length:0;return m(this,v)===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new S(this.type,t);for(let s of m(this,g))e.copyIn(s);return e}static fromGlob(t,e={}){var i;let s=new S(null,void 0,e);return B(i=S,it,wt).call(i,t,s,0,e),s}toMMPattern(){if(this!==m(this,I))return m(this,I).toMMPattern();let t=this.toString(),[e,s,i,n]=this.toRegExpSource();if(!(i||m(this,w)||m(this,K).nocase&&!m(this,K).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;let l=(m(this,K).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp(`^${e}$`,l),{_src:e,_glob:t})}toRegExpSource(t){let e=t??!!m(this,K).dot;if(m(this,I)===this&&B(this,Nt,Le).call(this),!this.type){let a=this.isStart()&&this.isEnd(),c=m(this,g).map(p=>{var L;let[b,h,y,X]=typeof p=="string"?B(L=S,Lt,Se).call(L,p,m(this,w),a):p.toRegExpSource(t);return x(this,w,m(this,w)||y),x(this,H,m(this,H)||X),b}).join(""),d="";if(this.isStart()&&typeof m(this,g)[0]=="string"&&!(m(this,g).length===1&&Zs.has(m(this,g)[0]))){let b=bs,h=e&&b.has(c.charAt(0))||c.startsWith("\\.")&&b.has(c.charAt(2))||c.startsWith("\\.\\.")&&b.has(c.charAt(4)),y=!e&&!t&&b.has(c.charAt(0));d=h?ps:y?It:""}let f="";return this.isEnd()&&m(m(this,I),D)&&m(this,W)?.type==="!"&&(f="(?:$|\\/)"),[d+c+f,P(c),x(this,w,!!m(this,w)),m(this,H)]}let s=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:",n=B(this,Zt,Jt).call(this,e);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){let a=this.toString();return x(this,g,[a]),this.type=null,x(this,w,void 0),[a,P(this.toString()),!1,!1]}let r=!s||t||e||!It?"":B(this,Zt,Jt).call(this,!0);r===n&&(r=""),r&&(n=`(?:${n})(?:${r})*?`);let l="";if(this.type==="!"&&m(this,bt))l=(this.isStart()&&!e?It:"")+Ne;else{let a=this.type==="!"?"))"+(this.isStart()&&!e&&!t?It:"")+we+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&r?")":this.type==="*"&&r?")?":`)${this.type}`;l=i+n+a}return[l,P(n),x(this,w,!!m(this,w)),m(this,H)]}},Q=S;I=new WeakMap,w=new WeakMap,H=new WeakMap,g=new WeakMap,W=new WeakMap,v=new WeakMap,et=new WeakMap,D=new WeakMap,K=new WeakMap,st=new WeakMap,bt=new WeakMap,Nt=new WeakSet,Le=function(){if(this!==m(this,I))throw new Error("should only call on root");if(m(this,D))return this;this.toString(),x(this,D,!0);let t;for(;t=m(this,et).pop();){if(t.type!=="!")continue;let e=t,s=m(e,W);for(;s;){for(let i=m(e,v)+1;!s.type&&i<m(s,g).length;i++)for(let n of m(t,g)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(m(s,g)[i])}e=s,s=m(e,W)}}return this},it=new WeakSet,wt=function(t,e,s,i){var p,b;let n=!1,r=!1,l=-1,a=!1;if(e.type===null){let h=s,y="";for(;h<t.length;){let X=t.charAt(h++);if(n||X==="\\"){n=!n,y+=X;continue}if(r){h===l+1?(X==="^"||X==="!")&&(a=!0):X==="]"&&!(h===l+2&&a)&&(r=!1),y+=X;continue}else if(X==="["){r=!0,l=h,a=!1,y+=X;continue}if(!i.noext&&Ie(X)&&t.charAt(h)==="("){e.push(y),y="";let L=new S(X,e);h=B(p=S,it,wt).call(p,t,L,h,i),e.push(L);continue}y+=X}return e.push(y),h}let c=s+1,d=new S(null,e),f=[],u="";for(;c<t.length;){let h=t.charAt(c++);if(n||h==="\\"){n=!n,u+=h;continue}if(r){c===l+1?(h==="^"||h==="!")&&(a=!0):h==="]"&&!(c===l+2&&a)&&(r=!1),u+=h;continue}else if(h==="["){r=!0,l=c,a=!1,u+=h;continue}if(Ie(h)&&t.charAt(c)==="("){d.push(u),u="";let y=new S(h,d);d.push(y),c=B(b=S,it,wt).call(b,t,y,c,i);continue}if(h==="|"){d.push(u),u="",f.push(d),d=new S(null,e);continue}if(h===")")return u===""&&m(e,g).length===0&&x(e,bt,!0),d.push(u),u="",e.push(...f,d),c;u+=h}return e.type=null,x(e,w,void 0),x(e,g,[t.substring(s-1)]),c},Zt=new WeakSet,Jt=function(t){return m(this,g).map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[s,i,n,r]=e.toRegExpSource(t);return x(this,H,m(this,H)||r),s}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")},Lt=new WeakSet,Se=function(t,e,s=!1){let i=!1,n="",r=!1;for(let l=0;l<t.length;l++){let a=t.charAt(l);if(i){i=!1,n+=(ys.has(a)?"\\":"")+a;continue}if(a==="\\"){l===t.length-1?n+="\\\\":i=!0;continue}if(a==="["){let[c,d,f,u]=Ve(t,l);if(f){n+=c,r=r||d,l+=f-1,e=e||u;continue}}if(a==="*"){s&&t==="*"?n+=Ne:n+=we,e=!0;continue}if(a==="?"){n+=At,e=!0;continue}n+=Gs(a)}return[n,P(t),!!e,r]},V(Q,it),V(Q,Lt);var Ut=(o,{windowsPathsNoEscape:t=!1}={})=>t?o.replace(/[?*()[\]]/g,"[$&]"):o.replace(/[?*()[\]\\]/g,"\\$&");var N=(o,t,e={})=>(ft(t),!e.nocomment&&t.charAt(0)==="#"?!1:new rt(t,e).match(o)),Rs=/^\*+([^+@!?\*\[\(]*)$/,Xs=o=>t=>!t.startsWith(".")&&t.endsWith(o),gs=o=>t=>t.endsWith(o),xs=o=>(o=o.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(o)),Ws=o=>(o=o.toLowerCase(),t=>t.toLowerCase().endsWith(o)),Vs=/^\*+\.\*+$/,Is=o=>!o.startsWith(".")&&o.includes("."),ws=o=>o!=="."&&o!==".."&&o.includes("."),Ns=/^\.\*+$/,Ls=o=>o!=="."&&o!==".."&&o.startsWith("."),Ss=/^\*+$/,Es=o=>o.length!==0&&!o.startsWith("."),_s=o=>o.length!==0&&o!=="."&&o!=="..",Cs=/^\?+([^+@!?\*\[\(]*)?$/,Ts=([o,t=""])=>{let e=Te([o]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},Fs=([o,t=""])=>{let e=Fe([o]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},ks=([o,t=""])=>{let e=Fe([o]);return t?s=>e(s)&&s.endsWith(t):e},Os=([o,t=""])=>{let e=Te([o]);return t?s=>e(s)&&s.endsWith(t):e},Te=([o])=>{let t=o.length;return e=>e.length===t&&!e.startsWith(".")},Fe=([o])=>{let t=o.length;return e=>e.length===t&&e!=="."&&e!==".."},ke=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Ee={win32:{sep:"\\"},posix:{sep:"/"}},Ys=ke==="win32"?Ee.win32.sep:Ee.posix.sep;N.sep=Ys;var C=Symbol("globstar **");N.GLOBSTAR=C;var Hs="[^/]",Ks=Hs+"*?",zs="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Bs="(?:(?!(?:\\/|^)\\.).)*?",Ms=(o,t={})=>e=>N(e,o,t);N.filter=Ms;var _=(o,t={})=>Object.assign({},o,t),Js=o=>{if(!o||typeof o!="object"||!Object.keys(o).length)return N;let t=N;return Object.assign((s,i,n={})=>t(s,i,_(o,n)),{Minimatch:class extends t.Minimatch{constructor(i,n={}){super(i,_(o,n))}static defaults(i){return t.defaults(_(o,i)).Minimatch}},AST:class extends t.AST{constructor(i,n,r={}){super(i,n,_(o,r))}static fromGlob(i,n={}){return t.AST.fromGlob(i,_(o,n))}},unescape:(s,i={})=>t.unescape(s,_(o,i)),escape:(s,i={})=>t.escape(s,_(o,i)),filter:(s,i={})=>t.filter(s,_(o,i)),defaults:s=>t.defaults(_(o,s)),makeRe:(s,i={})=>t.makeRe(s,_(o,i)),braceExpand:(s,i={})=>t.braceExpand(s,_(o,i)),match:(s,i,n={})=>t.match(s,i,_(o,n)),sep:t.sep,GLOBSTAR:C})};N.defaults=Js;var Oe=(o,t={})=>(ft(o),t.nobrace||!/\{(?:(?!\{).)*\}/.test(o)?[o]:(0,Ce.default)(o));N.braceExpand=Oe;var As=(o,t={})=>new rt(o,t).makeRe();N.makeRe=As;var Us=(o,t,e={})=>{let s=new rt(t,e);return o=o.filter(i=>s.match(i)),s.options.nonull&&!o.length&&o.push(t),o};N.match=Us;var _e=/[?*]|[+@!]\(.*?\)|\[|\]/,Ps=o=>o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),rt=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){ft(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||ke,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...n)=>console.error(...n)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let i=this.globParts.map((n,r,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){let a=n[0]===""&&n[1]===""&&(n[2]==="?"||!_e.test(n[2]))&&!_e.test(n[3]),c=/^[a-z]:/i.test(n[0]);if(a)return[...n.slice(0,4),...n.slice(4).map(d=>this.parse(d))];if(c)return[n[0],...n.slice(1).map(d=>this.parse(d))]}return n.map(a=>this.parse(a))});if(this.debug(this.pattern,i),this.set=i.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){let r=this.set[n];r[0]===""&&r[1]===""&&this.globParts[n][2]==="?"&&typeof r[3]=="string"&&/^[a-z]:$/i.test(r[3])&&(r[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let s=0;s<t.length;s++)for(let i=0;i<t[s].length;i++)t[s][i]==="**"&&(t[s][i]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let s=-1;for(;(s=e.indexOf("**",s+1))!==-1;){let i=s;for(;e[i+1]==="**";)i++;i!==s&&e.splice(s,i-s)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((s,i)=>{let n=s[s.length-1];return i==="**"&&n==="**"?s:i===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(s.pop(),s):(s.push(i),s)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let i=1;i<t.length-1;i++){let n=t[i];i===1&&n===""&&t[0]===""||(n==="."||n==="")&&(e=!0,t.splice(i,1),i--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let s=0;for(;(s=t.indexOf("..",s+1))!==-1;){let i=t[s-1];i&&i!=="."&&i!==".."&&i!=="**"&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let i=-1;for(;(i=s.indexOf("**",i+1))!==-1;){let r=i;for(;s[r+1]==="**";)r++;r>i&&s.splice(i+1,r-i);let l=s[i+1],a=s[i+2],c=s[i+3];if(l!==".."||!a||a==="."||a===".."||!c||c==="."||c==="..")continue;e=!0,s.splice(i,1);let d=s.slice(0);d[i]="**",t.push(d),i--}if(!this.preserveMultipleSlashes){for(let r=1;r<s.length-1;r++){let l=s[r];r===1&&l===""&&s[0]===""||(l==="."||l==="")&&(e=!0,s.splice(r,1),r--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(e=!0,s.pop())}let n=0;for(;(n=s.indexOf("..",n+1))!==-1;){let r=s[n-1];if(r&&r!=="."&&r!==".."&&r!=="**"){e=!0;let a=n===1&&s[n+1]==="**"?["."]:[];s.splice(n-1,2,...a),s.length===0&&s.push(""),n-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){let i=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);!i||(t[e]=i,t[s]=[])}return t.filter(e=>e.length)}partsMatch(t,e,s=!1){let i=0,n=0,r=[],l="";for(;i<t.length&&n<e.length;)if(t[i]===e[n])r.push(l==="b"?e[n]:t[i]),i++,n++;else if(s&&t[i]==="**"&&e[n]===t[i+1])r.push(t[i]),i++;else if(s&&e[n]==="**"&&t[i]===e[n+1])r.push(e[n]),n++;else if(t[i]==="*"&&e[n]&&(this.options.dot||!e[n].startsWith("."))&&e[n]!=="**"){if(l==="b")return!1;l="a",r.push(t[i]),i++,n++}else if(e[n]==="*"&&t[i]&&(this.options.dot||!t[i].startsWith("."))&&t[i]!=="**"){if(l==="a")return!1;l="b",r.push(e[n]),i++,n++}else return!1;return t.length===e.length&&r}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,s=0;for(let i=0;i<t.length&&t.charAt(i)==="!";i++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){let i=this.options;if(this.isWindows){let h=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),y=!h&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),X=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),L=!X&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),F=y?3:h?0:void 0,O=L?3:X?0:void 0;if(typeof F=="number"&&typeof O=="number"){let[z,E]=[t[F],e[O]];z.toLowerCase()===E.toLowerCase()&&(e[O]=z,O>F?e=e.slice(O):F>O&&(t=t.slice(F)))}}let{optimizationLevel:n=1}=this.options;n>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var r=0,l=0,a=t.length,c=e.length;r<a&&l<c;r++,l++){this.debug("matchOne loop");var d=e[l],f=t[r];if(this.debug(e,d,f),d===!1)return!1;if(d===C){this.debug("GLOBSTAR",[e,d,f]);var u=r,p=l+1;if(p===c){for(this.debug("** at the end");r<a;r++)if(t[r]==="."||t[r]===".."||!i.dot&&t[r].charAt(0)===".")return!1;return!0}for(;u<a;){var b=t[u];if(this.debug(`
globstar while`,t,u,e,p,b),this.matchOne(t.slice(u),e.slice(p),s))return this.debug("globstar found match!",u,a,b),!0;if(b==="."||b===".."||!i.dot&&b.charAt(0)==="."){this.debug("dot detected!",t,u,e,p);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(s&&(this.debug(`
>>> no match, partial?`,t,u,e,p),u===a))}let h;if(typeof d=="string"?(h=f===d,this.debug("string match",d,f,h)):(h=d.test(f),this.debug("pattern match",d,f,h)),!h)return!1}if(r===a&&l===c)return!0;if(r===a)return s;if(l===c)return r===a-1&&t[r]==="";throw new Error("wtf?")}braceExpand(){return Oe(this.pattern,this.options)}parse(t){ft(t);let e=this.options;if(t==="**")return C;if(t==="")return"";let s,i=null;(s=t.match(Ss))?i=e.dot?_s:Es:(s=t.match(Rs))?i=(e.nocase?e.dot?Ws:xs:e.dot?gs:Xs)(s[1]):(s=t.match(Cs))?i=(e.nocase?e.dot?Fs:Ts:e.dot?ks:Os)(s):(s=t.match(Vs))?i=e.dot?ws:Is:(s=t.match(Ns))&&(i=Ls);let n=Q.fromGlob(t,this.options).toMMPattern();return i?Object.assign(n,{test:i}):n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,s=e.noglobstar?Ks:e.dot?zs:Bs,i=new Set(e.nocase?["i"]:[]),n=t.map(a=>{let c=a.map(d=>{if(d instanceof RegExp)for(let f of d.flags.split(""))i.add(f);return typeof d=="string"?Ps(d):d===C?C:d._src});return c.forEach((d,f)=>{let u=c[f+1],p=c[f-1];d!==C||p===C||(p===void 0?u!==void 0&&u!==C?c[f+1]="(?:\\/|"+s+"\\/)?"+u:c[f]=s:u===void 0?c[f-1]=p+"(?:\\/|"+s+")?":u!==C&&(c[f-1]=p+"(?:\\/|\\/"+s+"\\/)"+u,c[f+1]=C))}),c.filter(d=>d!==C).join("/")}).join("|"),[r,l]=t.length>1?["(?:",")"]:["",""];n="^"+r+n+l+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let s=this.options;this.isWindows&&(t=t.split("\\").join("/"));let i=this.slashSplit(t);this.debug(this.pattern,"split",i);let n=this.set;this.debug(this.pattern,"set",n);let r=i[i.length-1];if(!r)for(let l=i.length-2;!r&&l>=0;l--)r=i[l];for(let l=0;l<n.length;l++){let a=n[l],c=i;if(s.matchBase&&a.length===1&&(c=[r]),this.matchOne(c,a,e))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(t){return N.defaults(t).Minimatch}};N.AST=Q;N.Minimatch=rt;N.escape=Ut;N.unescape=P;function Ye(o,t){return N(o,t)}var vs=5e3;var Ds=Atomics.waitAsync||(()=>{let o=`onmessage = ev => {
    const [b, i, v] = ev.data
    const f = new Int32Array(b)
    postMessage(Atomics.wait(f, i, v));
  }`,t=new Blob([o],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new ht(e);return(i,n,r)=>{let l=new Promise(a=>{s.once("message",c=>{a(c)})});return s.postMessage([i.buffer,n,r]),{async:!0,value:l}}})(),Pt=class{constructor(t,e,s,i){this.#t=null;this.worker=t,this.sharedData=e,this.sharedDataView=new DataView(e),this.hostFlag=new Int32Array(e),this.opts=s,this.#e=i,this.hostFlag[0]=ot.SAB_BASE_OFFSET,this.worker.on("message",n=>this.#s(n))}#e;#t;async reset(){return this.isActive()?!1:(await this.#i("reset"),this.#e[ct](),!0)}isActive(){return Boolean(this.#t)}async#s(t){switch(t?.type){case"invoke":return this.#l(t);case"return":return this.#r(t);case"log":return this.#n(t)}}#n(t){let e=this.opts.logger[t.level];typeof e!="function"?this.opts.logger?.error(`failed to find loglevel="${t.level}" on logger: message=${t.message}`):e.call(this.opts.logger,t.message)}#r(t){let e=this.#t||null;if(e===null)throw new Error('received "return" call with no corresponding request');this.#t=null;let[s,i]=e;if(!Array.isArray(t.results)||t.results.length!==2)return i(new Error('received malformed "return"'));let[n,r]=t.results;n?i(n):s(r)}async#i(t,...e){if(this.#t)throw new Error("plugin is not reentrant");let s,i,n=new Promise((r,l)=>{s=r,i=l});return this.#t=[s,i],this.worker.postMessage({type:"invoke",handler:t,args:e}),n}async functionExists(t){return await this.#i("functionExists",t)}async call(t,e){let s=this.#e[$](e),[i,n]=await this.callBlock(t,s),r=i!==null,l=i??n;if(l===null)return null;let a=this.#e[at](l);if(a===null)return null;let c=new Y(M.allowSharedBufferCodec?a.buffer:new Uint8Array(a.buffer).slice().buffer);if(r){let d=new TextDecoder().decode(c);throw new Error(`Plugin-originated error: ${d}`)}return c}async callBlock(t,e){let s=this.#e[Xt](),{results:i,state:n}=await this.#i("call",t,e,s);this.#e[Rt](n,!0);let[r,l]=i;if(r)throw r;return l}async#l(t){let e=new ot(this.sharedData),i=(this.opts.functions[t.namespace]??{})[t.func];try{if(!i)throw Error(`Plugin error: host function "${t.namespace}" "${t.func}" does not exist`);this.#e[Rt](t.state,!0);let n=await i(this.#e,...t.args),{blocks:r}=this.#e[Xt](),l;for(let[a,c]of r)l=e.writeUint8(4),l&&await l,l=e.writeUint32(c),l&&await l,l=e.writeUint32(a?.byteLength||0),l&&await l,a&&(l=e.write(a),l&&await l);typeof n=="bigint"?(l=e.writeUint8(1),l&&await l,l=e.writeUint64(n),l&&await l):typeof n=="number"?(l=e.writeUint8(2),l&&await l,l=e.writeFloat64(n),l&&await l):(l=e.writeUint8(3),l&&await l),l=e.writeUint8(0),l&&await l,await e.flush()}catch(n){this.close();let[,r]=this.#t;return this.#t=null,r(n)}}async getExports(t){return await this.#i("getExports",t??"0")}async getImports(t){return await this.#i("getImports",t??"0")}async getInstance(){throw new Error("todo")}async close(){this.worker&&(this.worker.terminate(),this.worker=null)}},vt=class{constructor(t,e){this.fetch=t,this.allowedHosts=e,this.lastStatusCode=0}contribute(t){t[ut]??={},t[ut].http_request=(e,s,i)=>this.makeRequest(e,s,i),t[ut].http_status_code=()=>this.lastStatusCode}async makeRequest(t,e,s){let i=t.read(e);if(i===null)return 0n;let{header:n,url:r,method:l}=i.json(),a=l??"GET",c=new URL(r);if(!this.allowedHosts.some(h=>h===c.hostname||Ye(c.hostname,h)))throw new Error(`Call error: HTTP request to "${c}" is not allowed (no allowedHosts match "${c.hostname}")`);let f=s===0n||a==="GET"||a==="HEAD"?null:t.read(s)?.bytes(),u=this.fetch,p=await u(r,{headers:n,method:a,...f?{body:f.slice()}:{}});return this.lastStatusCode=p.status,t.store(new Uint8Array(await p.arrayBuffer()))}};async function He(o,t,e){let s=new ht(ce),i=new nt(SharedArrayBuffer,o.logger,o.config);new vt(o.fetch,o.allowedHosts).contribute(o.functions),await new Promise((u,p)=>{s.on("message",function b(h){h?.type!=="initialized"&&p(new Error(`received unexpected message (type=${h?.type})`)),s.removeListener("message",b),u(null)})});let r=new SharedArrayBuffer(o.sharedArrayBufferSize),{fetch:l,logger:a,...c}=o,d={...c,type:"init",functions:Object.fromEntries(Object.entries(o.functions||{}).map(([u,p])=>[u,Object.keys(p)])),names:t,modules:e,sharedData:r},f=new Promise((u,p)=>{s.on("message",function b(h){h?.type!=="ready"&&p(new Error(`received unexpected message (type=${h?.type})`)),s.removeListener("message",b),u(null)})});return s.postMessage(d),await f,new Pt(s,r,o,i)}var T=class{constructor(t){this.scratch=new ArrayBuffer(8),this.scratchView=new DataView(this.scratch),this.output=t,this.outputOffset=T.SAB_BASE_OFFSET,this.flag=new Int32Array(this.output)}async flush(){if(this.outputOffset===T.SAB_BASE_OFFSET)return;let t=this.outputOffset;for(this.outputOffset=T.SAB_BASE_OFFSET;Atomics.compareExchange(this.flag,T.SAB_IDX,T.SAB_BASE_OFFSET,t)!==t;);Atomics.notify(this.flag,T.SAB_IDX,1);let e=Ds(this.flag,T.SAB_IDX,t,vs),s;try{s=setInterval(()=>{},0),e.async&&(e.value=await e.value)}finally{clearInterval(s)}if(e.value==="timed-out")throw new Error(`encountered timeout while flushing host function to worker memory ${this.flag[0]}`)}async spanningWrite(t){let e=0,s=this.output.byteLength-this.outputOffset,i=1+Math.floor((t.byteLength-s)/(this.output.byteLength-T.SAB_BASE_OFFSET)),n=(t.byteLength-s)%(this.output.byteLength-T.SAB_BASE_OFFSET);do new Uint8Array(this.output).set(t.subarray(e,e+s),this.outputOffset),this.outputOffset+=s,e+=s,await this.flush(),s=this.output.byteLength-T.SAB_BASE_OFFSET,--i;while(i!=0);n&&this.write(t.subarray(e,e+n))}write(t){if(t.byteLength+this.outputOffset<this.output.byteLength){new Uint8Array(this.output).set(new Uint8Array(t),this.outputOffset),this.outputOffset+=t.byteLength;return}return this.spanningWrite(new Uint8Array(t))}writeUint8(t){return this.scratchView.setUint8(0,t),this.write(this.scratch.slice(0,1))}writeUint32(t){return this.scratchView.setUint32(0,t,!0),this.write(this.scratch.slice(0,4))}writeUint64(t){return this.scratchView.setBigUint64(0,t,!0),this.write(this.scratch.slice(0,8))}writeFloat64(t){return this.scratchView.setFloat64(0,t,!0),this.write(this.scratch.slice(0,8))}},ot=T;ot.SAB_IDX=0,ot.SAB_BASE_OFFSET=4;async function Qs(o,t={}){if(t={...t},t.useWasi??=!1,t.enableWasiOutput??=t.useWasi?M.extismStdoutEnvVarSet:!1,t.functions=t.functions||{},t.allowedPaths??={},t.allowedHosts??=[].concat(t.allowedHosts||[]),t.logger??=console,t.config??={},t.fetch??=fetch,t.runInWorker??=!1,t.runInWorker&&!M.hasWorkerCapability)throw new Error("Cannot enable off-thread wasm; current context is not `crossOriginIsolated` (see https://mdn.io/crossOriginIsolated)");let[e,s]=await te(await Promise.resolve(o),t.fetch??fetch),i={allowedHosts:t.allowedHosts,allowedPaths:t.allowedPaths,functions:t.functions,fetch:t.fetch||fetch,wasiEnabled:t.useWasi,logger:t.logger,config:t.config,enableWasiOutput:t.enableWasiOutput,sharedArrayBufferSize:Number(t.sharedArrayBufferSize)||1<<16};return(t.runInWorker?He:ae)(i,e,s)}var Ai=Qs;export{M as CAPABILITIES,Qs as createPlugin,Ai as default,Qs as newPlugin};
//# sourceMappingURL=mod.js.map
